<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TimberTON - –†—É–±–∏ –¥–µ—Ä–µ–≤—å—è –∑–∞ TON</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent;
}

:root {
    --bg: #0a0a1a;
    --bg-card: #151528;
    --bg-hover: #202040;
    --primary: #ffd700;
    --secondary: #00d4ff;
    --success: #00ff88;
    --danger: #ff4757;
    --text: #ffffff;
    --text-muted: #8b8b9f;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    overflow: hidden;
}

.hidden { display: none !important; }

/* Header */
.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: rgba(10, 10, 26, 0.98);
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    z-index: 1000;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.balances {
    display: flex;
    gap: 16px;
}

.balance-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 15px;
    font-weight: 700;
}

.balance-item.ton { color: var(--primary); }
.balance-item.rub { color: var(--success); }

.menu-btn, .back-btn {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.1);
    background: var(--bg-card);
    color: var(--text);
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

/* Screens */
.screen {
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    display: none;
    padding: 20px;
    z-index: 100;
}

.screen.active { 
    display: block !important;
    z-index: 200;
}

/* Main Screen */
.main-header {
    text-align: center;
    padding: 20px 0;
}

.logo-big {
    font-size: 80px;
    margin-bottom: 10px;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.main-header h1 {
    font-size: 32px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary), #ffaa00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.main-header p {
    color: var(--text-muted);
    margin-top: 8px;
    font-size: 14px;
}

.preview-area {
    height: 200px;
    position: relative;
    margin: 30px 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tree-anim {
    font-size: 120px;
    animation: sway 3s ease-in-out infinite;
    transform-origin: bottom center;
}

@keyframes sway {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
}

.axe-anim {
    font-size: 60px;
    position: absolute;
    bottom: 30px;
    right: 20%;
    animation: chopAxe 0.8s ease-in-out infinite;
    transform-origin: bottom left;
}

@keyframes chopAxe {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(-30deg); }
}

/* Buttons */
.btn {
    width: 100%;
    padding: 18px 24px;
    border: none;
    border-radius: 16px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.btn:active { transform: scale(0.98); }

.btn-primary {
    background: linear-gradient(135deg, var(--primary), #e6c200);
    color: #000;
    box-shadow: 0 8px 32px rgba(255, 215, 0, 0.3);
    font-size: 18px;
    padding: 22px;
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.1);
}

.btn-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin: 12px 0;
}

/* Game Menu */
.section-title {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 12px;
    font-weight: 600;
}

.currency-tabs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    background: var(--bg-card);
    padding: 4px;
    border-radius: 16px;
    margin-bottom: 20px;
}

.currency-tab {
    padding: 16px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
}

.currency-tab.active {
    background: var(--primary);
    color: #000;
    box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
}

.bet-display {
    text-align: center;
    margin: 30px 0;
}

.bet-amount-big {
    font-size: 56px;
    font-weight: 800;
    color: var(--primary);
    text-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
}

.bet-slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: var(--bg-card);
    outline: none;
    -webkit-appearance: none;
    margin: 20px 0;
}

.bet-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
}

.bet-presets {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    margin-bottom: 24px;
}

.bet-presets button {
    padding: 12px;
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
}

.bet-presets button:active {
    background: var(--primary);
    color: #000;
}

.info-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
}

.info-card {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.05);
}

.info-card.highlight {
    border-color: var(--success);
    background: rgba(0, 255, 136, 0.05);
}

.info-card .label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 8px;
}

.info-card .value {
    font-size: 24px;
    font-weight: 800;
    color: var(--primary);
}

.info-card.highlight .value {
    color: var(--success);
}

.rules {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
}

.rules h3 {
    font-size: 16px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.rules ul {
    list-style: none;
}

.rules li {
    padding: 8px 0;
    padding-left: 28px;
    position: relative;
    color: var(--text-muted);
    font-size: 14px;
}

.rules li::before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: var(--success);
    font-weight: bold;
    width: 20px;
    height: 20px;
    background: rgba(0, 255, 136, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

/* Game Screen */
.game-screen {
    padding: 0;
    display: flex;
    flex-direction: column;
    z-index: 300;
}

.timer-bar {
    height: 6px;
    background: var(--bg-card);
    position: relative;
    overflow: hidden;
}

.timer-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--success), var(--primary), var(--danger));
    width: 100%;
    transition: width 0.1s linear;
}

.score-display {
    text-align: center;
    padding: 30px 20px;
}

.score-big {
    font-size: 80px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary), #ffaa00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
}

.score-target {
    color: var(--text-muted);
    margin-top: 8px;
    font-size: 16px;
}

.game-field {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.tree-container {
    position: relative;
    width: 120px;
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    gap: 4px;
}

.trunk-section {
    width: 80px;
    height: 60px;
    background: linear-gradient(90deg, #8B4513, #A0522D, #8B4513);
    border: 3px solid #5D3A1A;
    border-radius: 8px;
    position: relative;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    animation: dropIn 0.2s ease-out;
}

@keyframes dropIn {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.branch {
    position: absolute;
    width: 50px;
    height: 16px;
    background: linear-gradient(90deg, #228B22, #32CD32);
    border: 2px solid #006400;
    border-radius: 10px;
    top: 50%;
    transform: translateY(-50%);
}

.branch.left { left: -45px; }
.branch.right { right: -45px; }

.lumberjack {
    position: absolute;
    bottom: -90px;
    width: 70px;
    height: 80px;
    transition: all 0.15s;
    z-index: 10;
}

.lumberjack.left { left: -80px; }
.lumberjack.right { right: -80px; transform: scaleX(-1); }

.lumberjack-body {
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, #ff6b6b, #c92a2a);
    border-radius: 12px 12px 24px 24px;
    position: relative;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
}

.lumberjack-head {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 44px;
    height: 44px;
    background: #fdbf60;
    border-radius: 50%;
    border: 3px solid #8b4513;
}

.lumberjack-hat {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 54px;
    height: 22px;
    background: #c92a2a;
    border-radius: 6px;
}

.lumberjack-axe {
    position: absolute;
    right: -20px;
    top: 15px;
    font-size: 32px;
    animation: axeChop 0.3s ease-out;
}

@keyframes axeChop {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(-45deg); }
    100% { transform: rotate(0deg); }
}

.chop-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    padding: 20px;
    padding-bottom: 40px;
}

.chop-btn {
    height: 90px;
    border: none;
    border-radius: 20px;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 8px 0 rgba(0,0,0,0.3), 0 16px 32px rgba(0,0,0,0.3);
    transition: all 0.1s;
    position: relative;
    overflow: hidden;
    -webkit-touch-callout: none;
}

.chop-btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.chop-btn:active {
    transform: translateY(8px);
    box-shadow: 0 0 0 rgba( position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 44px;
    height: 44px;
    background: #fdbf60;
    border-radius: 50%;
    border: 3px solid #8b4513;
}

.lumberjack-hat {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 54px;
    height: 22px;
    background: #c92a2a;
    border-radius: 6px;
}

.lumberjack-axe {
    position: absolute;
    right: -20px;
    top: 15px;
    font-size: 32px;
    animation: axeChop 0.3s ease-out;
}

@keyframes axeChop {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(-45deg); }
    100% { transform: rotate(0deg); }
}

.chop-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    padding: 20px;
    padding-bottom: 40px;
}

.chop-btn {
    height: 90px;
    border: none;
    border-radius: 20px;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 8px 0 rgba(0,0,0,0.3), 0 16px 32px rgba(0,0,0,0.3);
    transition: all 0.1s;
    position: relative;
    overflow: hidden;
    -webkit-touch-callout: none;
}

.chop-btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.chop-btn:active {
    transform: translateY(8px);
    box-shadow: 0 0 0 rgba(0,0,0,0.3), 0 8px 16px rgba(0,0,0,0.2);
}

.chop-btn.left {
    background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
    color: white;
}

.chop-btn.right {
    background: linear-gradient(135deg, #4ecdc4, #44a08d);
    color: white;
}

/* Result Screen */
.result-screen {
    display: none;
    align-items: center;
    justify-content: center;
    text-align: center;
    z-index: 400;
    background: var(--bg);
}

.result-screen.active {
    display: flex !important;
}

.result-icon {
    font-size: 100px;
    margin-bottom: 20px;
    animation: bounce 0.5s ease-out;
}

@keyframes bounce {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.result-title {
    font-size: 36px;
    font-weight: 800;
    margin-bottom: 10px;
}

.result-screen.win .result-title { color: var(--success); }
.result-screen.lose .result-title { color: var(--danger); }

.result-stats {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 24px;
    margin: 24px 0;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.stat-row:last-child { border-bottom: none; }

.stat-label { color: var(--text-muted); }
.stat-value { font-weight: 700; font-size: 18px; }

.result-message {
    color: var(--text-muted);
    margin-bottom: 24px;
    font-size: 16px;
}

/* Payment Screens */
.payment-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.payment-card {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,0.05);
}

.payment-card:active {
    transform: scale(0.98);
    border-color: var(--primary);
}

.payment-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
}

.payment-card.ton .payment-icon { background: rgba(0, 136, 204, 0.2); }
.payment-card.rub .payment-icon { background: rgba(0, 255, 136, 0.2); }

.payment-info h3 {
    font-size: 18px;
    margin-bottom: 4px;
}

.payment-info p {
    color: var(--text-muted);
    font-size: 14px;
}

/* Forms */
.form-card {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 16px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 500;
}

.form-group input, .form-group select {
    width: 100%;
    background: var(--bg);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 16px;
    color: var(--text);
    font-size: 16px;
    outline: none;
}

.form-group input:focus {
    border-color: var(--primary);
}

.copy-box {
    background: var(--bg);
    border: 2px dashed rgba(255,255,255,0.2);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    word-break: break-all;
    font-family: monospace;
    font-size: 14px;
    color: var(--primary);
}

.copy-hint {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 8px;
}

.important-box {
    border-color: var(--danger);
    background: rgba(255, 71, 87, 0.05);
    color: var(--danger);
    font-weight: 700;
    font-size: 18px;
}

.hint-text {
    text-align: center;
    color: var(--text-muted);
    font-size: 13px;
    margin-top: 16px;
    line-height: 1.6;
}

/* History */
.history-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 4px;
}

.history-tab {
    padding: 12px 20px;
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    color: var(--text-muted);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
}

.history-tab.active {
    background: var(--primary);
    color: #000;
    border-color: var(--primary);
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.history-item {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-item .info { flex: 1; }
.history-item .type { font-weight: 700; margin-bottom: 4px; }
.history-item .date { font-size: 12px; color: var(--text-muted); }
.history-item .amount { font-weight: 800; font-size: 18px; }
.history-item .amount.positive { color: var(--success); }
.history-item .amount.negative { color: var(--danger); }

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
}

/* Notification */
.notification {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(-100px);
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 16px 24px;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    z-index: 10000;
    opacity: 0;
    transition: all 0.3s;
}

.notification.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

/* Wood chips */
.chip {
    position: absolute;
    width: 8px;
    height: 8px;
    background: #DEB887;
    border-radius: 2px;
    pointer-events: none;
    animation: chipFly 0.5s ease-out forwards;
}

@keyframes chipFly {
    0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
    100% { transform: translate(var(--tx), var(--ty)) rotate(var(--rot)); opacity: 0; }
}

/* Overlay fix */
.game-overlay {
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg);
    z-index: 350;
    display: none;
}

.game-overlay.active {
    display: block;
}
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="balances">
            <div class="balance-item ton">
                <span>üíé</span>
                <span id="bal-ton">0.00</span>
            </div>
            <div class="balance-item rub">
                <span>‚ÇΩ</span>
                <span id="bal-rub">0</span>
            </div>
        </div>
        <button class="menu-btn" onclick="goHome()">üè†</button>
    </div>

    <!-- Main Screen -->
    <div id="screen-main" class="screen active">
        <div class="main-header">
            <div class="logo-big">ü™ì</div>
            <h1>TimberTON</h1>
            <p>–†—É–±–∏ –¥–µ—Ä–µ–≤—å—è ‚Äî –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π TON –∏ —Ä—É–±–ª–∏!</p>
        </div>

        <div class="preview-area">
            <div class="tree-anim">üå≤</div>
            <div class="axe-anim">ü™ì</div>
        </div>

        <button class="btn btn-primary" onclick="openGameMenu()">
            üéÆ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
        </button>
        
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="openDeposit()">
                üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
            <button class="btn btn-secondary" onclick="openWithdraw()">
                üí∏ –í—ã–≤–µ—Å—Ç–∏
            </button>
        </div>
        
        <button class="btn btn-secondary" onclick="openHistory()" style="margin-top: 12px;">
            üìä –ò—Å—Ç–æ—Ä–∏—è
        </button>
    </div>

    <!-- Game Menu Screen -->
    <div id="screen-gamemenu" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–ù–æ–≤–∞—è –∏–≥—Ä–∞</h2>
        </div>

        <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É</div>
        <div class="currency-tabs">
            <button class="currency-tab active" id="tab-ton" onclick="setCurrency('ton')">
                üíé TON
            </button>
            <button class="currency-tab" id="tab-rub" onclick="setCurrency('rub')">
                ‚ÇΩ –†—É–±–ª–∏
            </button>
        </div>

        <div class="section-title">–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏</div>
        <div class="bet-display">
            <div class="bet-amount-big" id="bet-display">0.5 TON</div>
        </div>
        
        <input type="range" class="bet-slider" id="bet-slider" min="0.5" max="10" step="0.5" value="0.5" oninput="updateBet(this.value)">
        
        <div class="bet-presets" id="bet-presets">
            <button onclick="setBet(0.5)">0.5</button>
            <button onclick="setBet(1)">1</button>
            <button onclick="setBet(2)">2</button>
            <button onclick="setBet(5)">5</button>
            <button onclick="setBet(10)">10</button>
        </div>

        <div class="info-cards">
            <div class="info-card">
                <div class="label">üéØ –¶–µ–ª—å</div>
                <div class="value" id="target-display">50</div>
            </div>
            <div class="info-card highlight">
                <div class="label">üèÜ –í—ã–∏–≥—Ä—ã—à</div>
                <div class="value" id="prize-display">1.0 TON</div>
            </div>
        </div>

        <div class="rules">
            <h3>üìã –ü—Ä–∞–≤–∏–ª–∞</h3>
            <ul>
                <li>–†—É–±–∏ –¥–µ—Ä–µ–≤–æ –∫–Ω–æ–ø–∫–∞–º–∏ ‚Üê ‚Üí</li>
                <li>–ò–∑–±–µ–≥–∞–π –≤–µ—Ç–æ–∫ ‚Äî –∏–Ω–∞—á–µ –ø—Ä–æ–∏–≥—Ä—ã—à!</li>
                <li>–ö–∞–∂–¥—ã–π —É–¥–∞—Ä = +1 –æ—á–∫–æ</li>
                <li>–ù–∞–±–µ—Ä–∏ —Ü–µ–ª—å –∑–∞ 30 —Å–µ–∫—É–Ω–¥</li>
            </ul>
        </div>

        <button class="btn btn-primary" onclick="startGame()">
            ‚ñ∂Ô∏è –ò–ì–†–ê–¢–¨
        </button>
    </div>

    <!-- Game Screen -->
    <div id="screen-game" class="screen game-screen">
        <div class="timer-bar">
            <div class="timer-fill" id="timer-fill"></div>
        </div>
        
        <div class="score-display">
            <div class="score-big" id="game-score">0</div>
            <div class="score-target">–¶–µ–ª—å: <span id="game-target">50</span></div>
        </div>

        <div class="game-field">
            <div class="tree-container" id="tree">
                <div class="lumberjack left" id="lumberjack">
                    <div class="lumberjack-body">
                        <div class="lumberjack-head"></div>
                        <div class="lumberjack-hat"></div>
                        <div class="lumberjack-axe">ü™ì</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chop-controls">
            <button class="chop-btn left" id="btn-left">‚Üê</button>
            <button class="chop-btn right" id="btn-right">‚Üí</button>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="screen-result" class="screen result-screen">
        <div>
            <div class="result-icon" id="result-icon">üèÜ</div>
            <h2 class="result-title" id="result-title">–ü–æ–±–µ–¥–∞!</h2>
            
            <div class="result-stats">
                <div class="stat-row">
                    <span class="stat-label">–û—á–∫–∏</span>
                    <span class="stat-value" id="result-score">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–†–µ–∑—É–ª—å—Ç–∞—Ç</span>
                    <span class="stat-value" id="result-amount" style="color: var(--success);">+1.0 TON</span>
                </div>
            </div>

            <p class="result-message" id="result-message">–û—Ç–ª–∏—á–Ω–∞—è –∏–≥—Ä–∞!</p>

            <button class="btn btn-primary" onclick="openGameMenu()" style="margin-bottom: 12px;">
                üîÑ –ò–≥—Ä–∞—Ç—å –µ—â—ë
            </button>
            <button class="btn btn-secondary" onclick="goHome()">
                üè† –í –º–µ–Ω—é
            </button>
        </div>
    </div>

    <!-- Deposit Screen -->
    <div id="screen-deposit" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
        </div>

        <div class="payment-options">
            <div class="payment-card ton" onclick="openDepositTon()">
                <div class="payment-icon">üíé</div>
                <div class="payment-info">
                    <h3>–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</h3>
                    <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ TON –Ω–∞ –∞–¥—Ä–µ—Å –ø—Ä–æ–µ–∫—Ç–∞</p>
                </div>
            </div>
            
            <div class="payment-card rub" onclick="openDepositRub()">
                <div class="payment-icon">‚ÇΩ</div>
                <div class="payment-info">
                    <h3>–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Ä—É–±–ª–∏</h3>
                    <p>–ü–µ—Ä–µ–≤–æ–¥ –ø–æ –°–ë–ü –Ω–∞ OZON –ë–∞–Ω–∫</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit TON -->
    <div id="screen-deposit-ton" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openDeposit()">‚Üê</button>
            <h2 style="font-size: 20px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</h2>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–ê–¥—Ä–µ—Å –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                <div class="copy-box" onclick="copyText('UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh')">
                    UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh
                </div>
                <div class="copy-hint">üìã –ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–°–∫–æ–ª—å–∫–æ TON –æ—Ç–ø—Ä–∞–≤–∏–ª–∏</label>
                <input type="number" id="dep-ton-amount" step="0.1" min="1" placeholder="–ú–∏–Ω–∏–º—É–º 1 TON">
            </div>
            
            <div class="form-group">
                <label>–í–∞—à TON-–∞–¥—Ä–µ—Å (–¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞)</label>
                <input type="text" id="dep-ton-from" placeholder="UQ...">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitDepositTon()">
            ‚úÖ –Ø –æ—Ç–ø—Ä–∞–≤–∏–ª TON
        </button>
        
        <p class="hint-text">–ë–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</p>
    </div>

    <!-- Deposit RUB -->
    <div id="screen-deposit-rub" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openDeposit()">‚Üê</button>
            <h2 style="font-size: 20px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Ä—É–±–ª–∏</h2>
        </div>

        <div class="form-card" style="background: linear-gradient(135deg, #0057b8, #003d82); border: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span style="font-weight: 800; font-size: 20px;">OZON –ë–∞–Ω–∫</span>
                <span style="background: white; color: #0057b8; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">–°–ë–ü</span>
            </div>
            <div class="copy-box" onclick="copyText('+79941402339')" style="background: rgba(255,255,255,0.1); border: none; color: white; font-size: 22px;">
                +7 (994) 140-23-39
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–í–∞—à ID –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!)</label>
                <div class="copy-box important-box" id="pay-id-box" onclick="copyText(document.getElementById('pay-id').textContent)">
                    <span id="pay-id">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="copy-hint" style="color: var(--danger);">‚ö†Ô∏è –ë–µ–∑ —ç—Ç–æ–≥–æ ID –ø–ª–∞—Ç—ë–∂ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω!</div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (‚ÇΩ)</label>
                <input type="number" id="dep-rub-amount" min="100" step="100" placeholder="–ú–∏–Ω–∏–º—É–º 100 ‚ÇΩ">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitDepositRub()">
            ‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª
        </button>
        
        <p class="hint-text">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 5-15 –º–∏–Ω—É—Ç</p>
    </div>

    <!-- Withdraw Screen -->
    <div id="screen-withdraw" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
        </div>

        <div class="payment-options">
            <div class="payment-card ton" onclick="openWithdrawTon()">
                <div class="payment-icon">üíé</div>
                <div class="payment-info">
                    <h3>–í—ã–≤–µ—Å—Ç–∏ TON</h3>
                    <p>–ù–∞ –≤–∞—à TON-–∫–æ—à–µ–ª—ë–∫</p>
                </div>
            </div>
            
            <div class="payment-card rub" onclick="openWithdrawRub()">
                <div class="payment-icon">‚ÇΩ</div>
                <div class="payment-info">
                    <h3>–í—ã–≤–µ—Å—Ç–∏ —Ä—É–±–ª–∏</h3>
                    <p>–ù–∞ –∫–∞—Ä—Ç—É —á–µ—Ä–µ–∑ –°–ë–ü</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw TON -->
    <div id="screen-withdraw-ton" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openWithdraw()">‚Üê</button>
            <h2 style="font-size: 20px;">–í—ã–≤–æ–¥ TON</h2>
        </div>

        <div class="form-card">
            <div style="text-align: center; padding: 16px; color: var(--text-muted);">
                –î–æ—Å—Ç—É–ø–Ω–æ: <strong style="color: var(--primary); font-size: 24px;" id="wd-ton-balance">0.00</strong> TON
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>TON-–∞–¥—Ä–µ—Å</label>
                <input type="text" id="wd-ton-addr" placeholder="UQ... –∏–ª–∏ EQ...">
            </div>
            
            <div class="form-group">
                <label>–°—É–º–º–∞</label>
                <input type="number" id="wd-ton-amount" step="0.1" min="5" placeholder="–ú–∏–Ω–∏–º—É–º 5 TON">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitWithdrawTon()">
            üöÄ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—ã–≤–æ–¥
        </button>
        
        <p class="hint-text">–û–±—Ä–∞–±–æ—Ç–∫–∞: –¥–æ 24 —á–∞—Å–æ–≤. –ö–æ–º–∏—Å—Å–∏—è: 0%</p>
    </div>

    <!-- Withdraw RUB -->
    <div id="screen-withdraw-rub" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openWithdraw()">‚Üê</button>
            <h2 style="font-size: 20px;">–í—ã–≤–æ–¥ —Ä—É–±–ª–µ–π</h2>
        </div>

        <div class="form-card">
            <div style="text-align: center; padding: 16px; color: var(--text-muted);">
                –î–æ—Å—Ç—É–ø–Ω–æ: <strong style="color: var(--success); font-size: 24px;" id="wd-rub-balance">0</strong> ‚ÇΩ
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–°–ë–ü)</label>
                <input type="tel" id="wd-rub-phone" placeholder="+7 (999) 123-45-67">
            </div>
            
            <div class="form-group">
                <label>–ë–∞–Ω–∫</label>
                <select id="wd-rub-bank">
                    <option value="–°–±–µ—Ä–±–∞–Ω–∫">üè¶ –°–±–µ—Ä–±–∞–Ω–∫</option>
                    <option value="–¢–∏–Ω—å–∫–æ—Ñ—Ñ">üü° –¢–∏–Ω—å–∫–æ—Ñ—Ñ</option>
                    <option value="–í–¢–ë">üîµ –í–¢–ë</option>
                    <option value="–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫">üü£ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫</option>
                    <option value="–†–∞–π—Ñ—Ñ–∞–π–∑–µ–Ω">üü¢ –†–∞–π—Ñ—Ñ–∞–π–∑–µ–Ω</option>
                    <option value="–î—Ä—É–≥–æ–π">‚ö™ –î—Ä—É–≥–æ–π</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–°—É–º–º–∞ (‚ÇΩ)</label>
                <input type="number" id="wd-rub-amount" min="500" step="100" placeholder="–ú–∏–Ω–∏–º—É–º  position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 44px;
    height: 44px;
    background: #fdbf60;
    border-radius: 50%;
    border: 3px solid #8b4513;
}

.lumberjack-hat {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 54px;
    height: 22px;
    background: #c92a2a;
    border-radius: 6px;
}

.lumberjack-axe {
    position: absolute;
    right: -20px;
    top: 15px;
    font-size: 32px;
    animation: axeChop 0.3s ease-out;
}

@keyframes axeChop {
    0% { transform: rotate(0deg); }
    50% { transform: rotate(-45deg); }
    100% { transform: rotate(0deg); }
}

.chop-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    padding: 20px;
    padding-bottom: 40px;
}

.chop-btn {
    height: 90px;
    border: none;
    border-radius: 20px;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 8px 0 rgba(0,0,0,0.3), 0 16px 32px rgba(0,0,0,0.3);
    transition: all 0.1s;
    position: relative;
    overflow: hidden;
    -webkit-touch-callout: none;
}

.chop-btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.chop-btn:active {
    transform: translateY(8px);
    box-shadow: 0 0 0 rgba(0,0,0,0.3), 0 8px 16px rgba(0,0,0,0.2);
}

.chop-btn.left {
    background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
    color: white;
}

.chop-btn.right {
    background: linear-gradient(135deg, #4ecdc4, #44a08d);
    color: white;
}

/* Result Screen */
.result-screen {
    display: none;
    align-items: center;
    justify-content: center;
    text-align: center;
    z-index: 400;
    background: var(--bg);
}

.result-screen.active {
    display: flex !important;
}

.result-icon {
    font-size: 100px;
    margin-bottom: 20px;
    animation: bounce 0.5s ease-out;
}

@keyframes bounce {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.result-title {
    font-size: 36px;
    font-weight: 800;
    margin-bottom: 10px;
}

.result-screen.win .result-title { color: var(--success); }
.result-screen.lose .result-title { color: var(--danger); }

.result-stats {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 24px;
    margin: 24px 0;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.stat-row:last-child { border-bottom: none; }

.stat-label { color: var(--text-muted); }
.stat-value { font-weight: 700; font-size: 18px; }

.result-message {
    color: var(--text-muted);
    margin-bottom: 24px;
    font-size: 16px;
}

/* Payment Screens */
.payment-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.payment-card {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,0.05);
}

.payment-card:active {
    transform: scale(0.98);
    border-color: var(--primary);
}

.payment-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
}

.payment-card.ton .payment-icon { background: rgba(0, 136, 204, 0.2); }
.payment-card.rub .payment-icon { background: rgba(0, 255, 136, 0.2); }

.payment-info h3 {
    font-size: 18px;
    margin-bottom: 4px;
}

.payment-info p {
    color: var(--text-muted);
    font-size: 14px;
}

/* Forms */
.form-card {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 16px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 500;
}

.form-group input, .form-group select {
    width: 100%;
    background: var(--bg);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 16px;
    color: var(--text);
    font-size: 16px;
    outline: none;
}

.form-group input:focus {
    border-color: var(--primary);
}

.copy-box {
    background: var(--bg);
    border: 2px dashed rgba(255,255,255,0.2);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    word-break: break-all;
    font-family: monospace;
    font-size: 14px;
    color: var(--primary);
}

.copy-hint {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 8px;
}

.important-box {
    border-color: var(--danger);
    background: rgba(255, 71, 87, 0.05);
    color: var(--danger);
    font-weight: 700;
    font-size: 18px;
}

.hint-text {
    text-align: center;
    color: var(--text-muted);
    font-size: 13px;
    margin-top: 16px;
    line-height: 1.6;
}

/* History */
.history-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 4px;
}

.history-tab {
    padding: 12px 20px;
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    color: var(--text-muted);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
}

.history-tab.active {
    background: var(--primary);
    color: #000;
    border-color: var(--primary);
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.history-item {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-item .info { flex: 1; }
.history-item .type { font-weight: 700; margin-bottom: 4px; }
.history-item .date { font-size: 12px; color: var(--text-muted); }
.history-item .amount { font-weight: 800; font-size: 18px; }
.history-item .amount.positive { color: var(--success); }
.history-item .amount.negative { color: var(--danger); }

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
}

/* Notification */
.notification {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(-100px);
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 16px 24px;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    z-index: 10000;
    opacity: 0;
    transition: all 0.3s;
}

.notification.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

/* Wood chips */
.chip {
    position: absolute;
    width: 8px;
    height: 8px;
    background: #DEB887;
    border-radius: 2px;
    pointer-events: none;
    animation: chipFly 0.5s ease-out forwards;
}

@keyframes chipFly {
    0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
    100% { transform: translate(var(--tx), var(--ty)) rotate(var(--rot)); opacity: 0; }
}

/* Overlay fix */
.game-overlay {
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg);
    z-index: 350;
    display: none;
}

.game-overlay.active {
    display: block;
}
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="balances">
            <div class="balance-item ton">
                <span>üíé</span>
                <span id="bal-ton">0.00</span>
            </div>
            <div class="balance-item rub">
                <span>‚ÇΩ</span>
                <span id="bal-rub">0</span>
            </div>
        </div>
        <button class="menu-btn" onclick="goHome()">üè†</button>
    </div>

    <!-- Main Screen -->
    <div id="screen-main" class="screen active">
        <div class="main-header">
            <div class="logo-big">ü™ì</div>
            <h1>TimberTON</h1>
            <p>–†—É–±–∏ –¥–µ—Ä–µ–≤—å—è ‚Äî –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π TON –∏ —Ä—É–±–ª–∏!</p>
        </div>

        <div class="preview-area">
            <div class="tree-anim">üå≤</div>
            <div class="axe-anim">ü™ì</div>
        </div>

        <button class="btn btn-primary" onclick="openGameMenu()">
            üéÆ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
        </button>
        
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="openDeposit()">
                üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
            <button class="btn btn-secondary" onclick="openWithdraw()">
                üí∏ –í—ã–≤–µ—Å—Ç–∏
            </button>
        </div>
        
        <button class="btn btn-secondary" onclick="openHistory()" style="margin-top: 12px;">
            üìä –ò—Å—Ç–æ—Ä–∏—è
        </button>
    </div>

    <!-- Game Menu Screen -->
    <div id="screen-gamemenu" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–ù–æ–≤–∞—è –∏–≥—Ä–∞</h2>
        </div>

        <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É</div>
        <div class="currency-tabs">
            <button class="currency-tab active" id="tab-ton" onclick="setCurrency('ton')">
                üíé TON
            </button>
            <button class="currency-tab" id="tab-rub" onclick="setCurrency('rub')">
                ‚ÇΩ –†—É–±–ª–∏
            </button>
        </div>

        <div class="section-title">–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏</div>
        <div class="bet-display">
            <div class="bet-amount-big" id="bet-display">0.5 TON</div>
        </div>
        
        <input type="range" class="bet-slider" id="bet-slider" min="0.5" max="10" step="0.5" value="0.5" oninput="updateBet(this.value)">
        
        <div class="bet-presets" id="bet-presets">
            <button onclick="setBet(0.5)">0.5</button>
            <button onclick="setBet(1)">1</button>
            <button onclick="setBet(2)">2</button>
            <button onclick="setBet(5)">5</button>
            <button onclick="setBet(10)">10</button>
        </div>

        <div class="info-cards">
            <div class="info-card">
                <div class="label">üéØ –¶–µ–ª—å</div>
                <div class="value" id="target-display">50</div>
            </div>
            <div class="info-card highlight">
                <div class="label">üèÜ –í—ã–∏–≥—Ä—ã—à</div>
                <div class="value" id="prize-display">1.0 TON</div>
            </div>
        </div>

        <div class="rules">
            <h3>üìã –ü—Ä–∞–≤–∏–ª–∞</h3>
            <ul>
                <li>–†—É–±–∏ –¥–µ—Ä–µ–≤–æ –∫–Ω–æ–ø–∫–∞–º–∏ ‚Üê ‚Üí</li>
                <li>–ò–∑–±–µ–≥–∞–π –≤–µ—Ç–æ–∫ ‚Äî –∏–Ω–∞—á–µ –ø—Ä–æ–∏–≥—Ä—ã—à!</li>
                <li>–ö–∞–∂–¥—ã–π —É–¥–∞—Ä = +1 –æ—á–∫–æ</li>
                <li>–ù–∞–±–µ—Ä–∏ —Ü–µ–ª—å –∑–∞ 30 —Å–µ–∫—É–Ω–¥</li>
            </ul>
        </div>

        <button class="btn btn-primary" onclick="startGame()">
            ‚ñ∂Ô∏è –ò–ì–†–ê–¢–¨
        </button>
    </div>

    <!-- Game Screen -->
    <div id="screen-game" class="screen game-screen">
        <div class="timer-bar">
            <div class="timer-fill" id="timer-fill"></div>
        </div>
        
        <div class="score-display">
            <div class="score-big" id="game-score">0</div>
            <div class="score-target">–¶–µ–ª—å: <span id="game-target">50</span></div>
        </div>

        <div class="game-field">
            <div class="tree-container" id="tree">
                <div class="lumberjack left" id="lumberjack">
                    <div class="lumberjack-body">
                        <div class="lumberjack-head"></div>
                        <div class="lumberjack-hat"></div>
                        <div class="lumberjack-axe">ü™ì</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chop-controls">
            <button class="chop-btn left" id="btn-left">‚Üê</button>
            <button class="chop-btn right" id="btn-right">‚Üí</button>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="screen-result" class="screen result-screen">
        <div>
            <div class="result-icon" id="result-icon">üèÜ</div>
            <h2 class="result-title" id="result-title">–ü–æ–±–µ–¥–∞!</h2>
            
            <div class="result-stats">
                <div class="stat-row">
                    <span class="stat-label">–û—á–∫–∏</span>
                    <span class="stat-value" id="result-score">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–†–µ–∑—É–ª—å—Ç–∞—Ç</span>
                    <span class="stat-value" id="result-amount" style="color: var(--success);">+1.0 TON</span>
                </div>
            </div>

            <p class="result-message" id="result-message">–û—Ç–ª–∏—á–Ω–∞—è –∏–≥—Ä–∞!</p>

            <button class="btn btn-primary" onclick="openGameMenu()" style="margin-bottom: 12px;">
                üîÑ –ò–≥—Ä–∞—Ç—å –µ—â—ë
            </button>
            <button class="btn btn-secondary" onclick="goHome()">
                üè† –í –º–µ–Ω—é
            </button>
        </div>
    </div>

    <!-- Deposit Screen -->
    <div id="screen-deposit" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
        </div>

        <div class="payment-options">
            <div class="payment-card ton" onclick="openDepositTon()">
                <div class="payment-icon">üíé</div>
                <div class="payment-info">
                    <h3>–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</h3>
                    <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ TON –Ω–∞ –∞–¥—Ä–µ—Å –ø—Ä–æ–µ–∫—Ç–∞</p>
                </div>
            </div>
            
            <div class="payment-card rub" onclick="openDepositRub()">
                <div class="payment-icon">‚ÇΩ</div>
                <div class="payment-info">
                    <h3>–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Ä—É–±–ª–∏</h3>
                    <p>–ü–µ—Ä–µ–≤–æ–¥ –ø–æ –°–ë–ü –Ω–∞ OZON –ë–∞–Ω–∫</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit TON -->
    <div id="screen-deposit-ton" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openDeposit()">‚Üê</button>
            <h2 style="font-size: 20px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</h2>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–ê–¥—Ä–µ—Å –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                <div class="copy-box" onclick="copyText('UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh')">
                    UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh
                </div>
                <div class="copy-hint">üìã –ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–°–∫–æ–ª—å–∫–æ TON –æ—Ç–ø—Ä–∞–≤–∏–ª–∏</label>
                <input type="number" id="dep-ton-amount" step="0.1" min="1" placeholder="–ú–∏–Ω–∏–º—É–º 1 TON">
            </div>
            
            <div class="form-group">
                <label>–í–∞—à TON-–∞–¥—Ä–µ—Å (–¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞)</label>
                <input type="text" id="dep-ton-from" placeholder="UQ...">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitDepositTon()">
            ‚úÖ –Ø –æ—Ç–ø—Ä–∞–≤–∏–ª TON
        </button>
        
        <p class="hint-text">–ë–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</p>
    </div>

    <!-- Deposit RUB -->
    <div id="screen-deposit-rub" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openDeposit()">‚Üê</button>
            <h2 style="font-size: 20px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Ä—É–±–ª–∏</h2>
        </div>

        <div class="form-card" style="background: linear-gradient(135deg, #0057b8, #003d82); border: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span style="font-weight: 800; font-size: 20px;">OZON –ë–∞–Ω–∫</span>
                <span style="background: white; color: #0057b8; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">–°–ë–ü</span>
            </div>
            <div class="copy-box" onclick="copyText('+79941402339')" style="background: rgba(255,255,255,0.1); border: none; color: white; font-size: 22px;">
                +7 (994) 140-23-39
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–í–∞—à ID –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!)</label>
                <div class="copy-box important-box" id="pay-id-box" onclick="copyText(document.getElementById('pay-id').textContent)">
                    <span id="pay-id">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="copy-hint" style="color: var(--danger);">‚ö†Ô∏è –ë–µ–∑ —ç—Ç–æ–≥–æ ID –ø–ª–∞—Ç—ë–∂ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω!</div>
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (‚ÇΩ)</label>
                <input type="number" id="dep-rub-amount" min="100" step="100" placeholder="–ú–∏–Ω–∏–º—É–º 100 ‚ÇΩ">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitDepositRub()">
            ‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª
        </button>
        
        <p class="hint-text">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 5-15 –º–∏–Ω—É—Ç</p>
    </div>

    <!-- Withdraw Screen -->
    <div id="screen-withdraw" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
        </div>

        <div class="payment-options">
            <div class="payment-card ton" onclick="openWithdrawTon()">
                <div class="payment-icon">üíé</div>
                <div class="payment-info">
                    <h3>–í—ã–≤–µ—Å—Ç–∏ TON</h3>
                    <p>–ù–∞ –≤–∞—à TON-–∫–æ—à–µ–ª—ë–∫</p>
                </div>
            </div>
            
            <div class="payment-card rub" onclick="openWithdrawRub()">
                <div class="payment-icon">‚ÇΩ</div>
                <div class="payment-info">
                    <h3>–í—ã–≤–µ—Å—Ç–∏ —Ä—É–±–ª–∏</h3>
                    <p>–ù–∞ –∫–∞—Ä—Ç—É —á–µ—Ä–µ–∑ –°–ë–ü</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw TON -->
    <div id="screen-withdraw-ton" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openWithdraw()">‚Üê</button>
            <h2 style="font-size: 20px;">–í—ã–≤–æ–¥ TON</h2>
        </div>

        <div class="form-card">
            <div style="text-align: center; padding: 16px; color: var(--text-muted);">
                –î–æ—Å—Ç—É–ø–Ω–æ: <strong style="color: var(--primary); font-size: 24px;" id="wd-ton-balance">0.00</strong> TON
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>TON-–∞–¥—Ä–µ—Å</label>
                <input type="text" id="wd-ton-addr" placeholder="UQ... –∏–ª–∏ EQ...">
            </div>
            
            <div class="form-group">
                <label>–°—É–º–º–∞</label>
                <input type="number" id="wd-ton-amount" step="0.1" min="5" placeholder="–ú–∏–Ω–∏–º—É–º 5 TON">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitWithdrawTon()">
            üöÄ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—ã–≤–æ–¥
        </button>
        
        <p class="hint-text">–û–±—Ä–∞–±–æ—Ç–∫–∞: –¥–æ 24 —á–∞—Å–æ–≤. –ö–æ–º–∏—Å—Å–∏—è: 0%</p>
    </div>

    <!-- Withdraw RUB -->
    <div id="screen-withdraw-rub" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="openWithdraw()">‚Üê</button>
            <h2 style="font-size: 20px;">–í—ã–≤–æ–¥ —Ä—É–±–ª–µ–π</h2>
        </div>

        <div class="form-card">
            <div style="text-align: center; padding: 16px; color: var(--text-muted);">
                –î–æ—Å—Ç—É–ø–Ω–æ: <strong style="color: var(--success); font-size: 24px;" id="wd-rub-balance">0</strong> ‚ÇΩ
            </div>
        </div>

        <div class="form-card">
            <div class="form-group">
                <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–°–ë–ü)</label>
                <input type="tel" id="wd-rub-phone" placeholder="+7 (999) 123-45-67">
            </div>
            
            <div class="form-group">
                <label>–ë–∞–Ω–∫</label>
                <select id="wd-rub-bank">
                    <option value="–°–±–µ—Ä–±–∞–Ω–∫">üè¶ –°–±–µ—Ä–±–∞–Ω–∫</option>
                    <option value="–¢–∏–Ω—å–∫–æ—Ñ—Ñ">üü° –¢–∏–Ω—å–∫–æ—Ñ—Ñ</option>
                    <option value="–í–¢–ë">üîµ –í–¢–ë</option>
                    <option value="–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫">üü£ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫</option>
                    <option value="–†–∞–π—Ñ—Ñ–∞–π–∑–µ–Ω">üü¢ –†–∞–π—Ñ—Ñ–∞–π–∑–µ–Ω</option>
                    <option value="–î—Ä—É–≥–æ–π">‚ö™ –î—Ä—É–≥–æ–π</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–°—É–º–º–∞ (‚ÇΩ)</label>
                <input type="number" id="wd-rub-amount" min="500" step="100" placeholder="–ú–∏–Ω–∏–º—É–º 500 ‚ÇΩ">
            </div>
        </div>

        <button class="btn btn-primary" onclick="submitWithdrawRub()">
            üöÄ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—ã–≤–æ–¥
        </button>
        
        <p class="hint-text">–û–±—Ä–∞–±–æ—Ç–∫–∞: –¥–æ 24 —á–∞—Å–æ–≤. –ö–æ–º–∏—Å—Å–∏—è: 0%</p>
    </div>

    <!-- History Screen -->
    <div id="screen-history" class="screen">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <button class="back-btn" onclick="goHome()">‚Üê</button>
            <h2 style="font-size: 20px;">–ò—Å—Ç–æ—Ä–∏—è</h2>
        </div>

        <div class="history-tabs">
            <button class="history-tab active" onclick="setHistoryTab('games', this)">üéÆ –ò–≥—Ä—ã</button>
            <button class="history-tab" onclick="setHistoryTab('deposits', this)">üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
            <button class="history-tab" onclick="setHistoryTab('withdrawals', this)">üí∏ –í—ã–≤–æ–¥—ã</button>
        </div>

        <div class="history-list" id="history-list">
            <div class="empty-state">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notif-text"></span>
    </div>

    <script>
// Telegram WebApp
const tg = window.Telegram.WebApp;
tg.expand();
tg.ready();

// User data
let user = {
    id: tg.initDataUnsafe?.user?.id?.toString() || 'demo_' + Date.now(),
    username: tg.initDataUnsafe?.user?.username || 'player',
    balanceTon: 10.00,
    balanceRub: 1000
};

// Game state
let game = {
    active: false,
    score: 0,
    target: 50,
    timeLeft: 30,
    timer: null,
    bet: 0.5,
    currency: 'ton',
    position: 'left',
    tree: []
};

// History
let historyData = {
    games: [],
    deposits: [],
    withdrawals: []
};

// Screen navigation - –ò–°–ü–†–ê–í–õ–ï–ù–û
function showScreen(id) {
    // –°–∫—Ä—ã–≤–∞–µ–º –í–°–ï —ç–∫—Ä–∞–Ω—ã
    document.querySelectorAll('.screen').forEach(function(s) {
        s.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
    const target = document.getElementById('screen-' + id);
    if (target) {
        target.classList.add('active');
    }
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤
    if (id === 'deposit-rub') {
        generatePayId();
    } else if (id === 'withdraw-ton') {
        document.getElementById('wd-ton-balance').textContent = user.balanceTon.toFixed(2);
    } else if (id === 'withdraw-rub') {
        document.getElementById('wd-rub-balance').textContent = user.balanceRub;
    } else if (id === 'history') {
        renderHistory();
    }
}

function goHome() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞
    if (game.active) {
        endGame(false);
    }
    showScreen('main');
    updateBalance();
}

function openGameMenu() {
    showScreen('gamemenu');
    setCurrency('ton');
}

function openDeposit() { showScreen('deposit'); }
function openDepositTon() { showScreen('deposit-ton'); }
function openDepositRub() { showScreen('deposit-rub'); }
function openWithdraw() { showScreen('withdraw'); }
function openWithdrawTon() { showScreen('withdraw-ton'); }
function openWithdrawRub() { showScreen('withdraw-rub'); }
function openHistory() { 
    showScreen('history'); 
    setHistoryTab('games', document.querySelector('.history-tab'));
}

// Currency & Betting
function setCurrency(curr) {
    game.currency = curr;
    document.getElementById('tab-ton').classList.toggle('active', curr === 'ton');
    document.getElementById('tab-rub').classList.toggle('active', curr === 'rub');
    
    const isTon = curr === 'ton';
    const slider = document.getElementById('bet-slider');
    const presets = document.getElementById('bet-presets');
    
    slider.min = isTon ? 0.5 : 50;
    slider.max = isTon ? 10 : 1000;
    slider.step = isTon ? 0.5 : 50;
    slider.value = isTon ? 0.5 : 50;
    
    const vals = isTon ? [0.5, 1, 2, 5, 10] : [50, 100, 250, 500, 1000];
    presets.innerHTML = vals.map(function(v) { 
        return '<button onclick="setBet(' + v + ')">' + v + '</button>';
    }).join('');
    
    updateBet(slider.value);
}

function updateBet(val) {
    game.bet = parseFloat(val);
    const sym = game.currency === 'ton' ? ' TON' : ' ‚ÇΩ';
    document.getElementById('bet-display').textContent = val + sym;
    
    const target = Math.floor(30 + (game.bet * (game.currency === 'ton' ? 20 : 0.4)));
    game.target = target;
    document.getElementById('target-display').textContent = target;
    
    const prize = game.bet * 2;
    document.getElementById('prize-display').textContent = prize + sym;
}

function setBet(val) {
    document.getElementById('bet-slider').value = val;
    updateBet(val);
}

// Game logic - –ò–°–ü–†–ê–í–õ–ï–ù–û
function startGame() {
    const bal = game.currency === 'ton' ? user.balanceTon : user.balanceRub;
    if (bal < game.bet) {
        notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
        return;
    }
    
    // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
    if (game.currency === 'ton') user.balanceTon -= game.bet;
    else user.balanceRub -= game.bet;
    updateBalance();
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    game.active = true;
    game.score = 0;
    game.timeLeft = 30;
    game.tree = [];
    game.position = 'left';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã
    showScreen('game');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    document.getElementById('game-score').textContent = '0';
    document.getElementById('game-target').textContent = game.target;
    document.getElementById('timer-fill').style.width = '100%';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ª–µ—Å–æ—Ä—É–±–∞
    const lumberjack = document.getElementById('lumberjack');
    lumberjack.className = 'lumberjack left';
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ—Ä–µ–≤–æ
    generateTree();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
    if (game.timer) clearInterval(game.timer);
    game.timer = setInterval(function() {
        if (!game.active) return;
        game.timeLeft -= 0.1;
        const pct = Math.max(0, (game.timeLeft / 30) * 100);
        document.getElementById('timer-fill').style.width = pct + '%';
        if (game.timeLeft <= 0) {
            endGame(false);
        }
    }, 100);
}

function generateTree() {
    const container = document.getElementById('tree');
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏ –∫—Ä–æ–º–µ –ª–µ—Å–æ—Ä—É–±–∞
    container.querySelectorAll('.trunk-section').forEach(function(e) { 
        e.remove(); 
    });
    game.tree = [];
    
    // –°–æ–∑–¥–∞–µ–º 6 —Å–µ–∫—Ü–∏–π
    for (let i = 0; i < 6; i++) {
        const div = document.createElement('div');
        div.className = 'trunk-section';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ç–∫–∏ (–∫—Ä–æ–º–µ –Ω–∏–∂–Ω–µ–π —Å–µ–∫—Ü–∏–∏)
        if (Math.random() > 0.4 && i > 0) {
            const side = Math.random() > 0.5 ? 'left' : 'right';
            const b = document.createElement('div');
            b.className = 'branch ' + side;
            div.appendChild(b);
            game.tree.push(side);
        } else {
            game.tree.push(null);
        }
        container.appendChild(div);
    }
}

function doChop(side) {
    if (!game.active) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –≤–µ—Ç–∫–æ–π
    if (game.tree[0] === side) {
        endGame(false);
        return;
    }
    
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç
    game.score++;
    game.timeLeft = Math.min(game.timeLeft + 0.5, 30); // –ë–æ–Ω—É—Å –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('game-score').textContent = game.score;
    
    // –ê–Ω–∏–º–∏—Ä—É–µ–º –ª–µ—Å–æ—Ä—É–±–∞
    const lumberjack = document.getElementById('lumberjack');
    lumberjack.className = 'lumberjack ' + side;
    
    // –°–æ–∑–¥–∞–µ–º —â–µ–ø–∫–∏
    createChips(side);
    
    // –£–¥–∞–ª—è–µ–º –Ω–∏–∂–Ω—é—é —Å–µ–∫—Ü–∏—é
    const container = document.getElementById('tree');
    const secs = container.querySelectorAll('.trunk-section');
    if (secs.length > 0) secs[0].remove();
    game.tree.shift();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é —Å–≤–µ—Ä—Ö—É
    const div = document.createElement('div');
    div.className = 'trunk-section';
    if (Math.random() > 0.4) {
        const bs = Math.random() > 0.5 ? 'left' : 'right';
        const b = document.createElement('div');
        b.className = 'branch ' + bs;
        div.appendChild(b);
        game.tree.push(bs);
    } else {
        game.tree.push(null);
    }
    container.appendChild(div);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
    if (game.score >= game.target) {
        endGame(true);
    }
}

function createChips(side) {
    const container = document.getElementById('tree');
    for (let i = 0; i < 5; i++) {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.style.left = '60px';
        chip.style.top = '200px';
        const angle = (Math.random() - 0.5) * 60 + (side === 'left' ? -30 : 30);
        const dist = 50 + Math.random() * 100;
        chip.style.setProperty('--tx', Math.sin(angle * Math.PI / 180) * dist + 'px');
        chip.style.setProperty('--ty', -Math.cos(angle * Math.PI / 180) * dist - 50 + 'px');
        chip.style.setProperty('--rot', Math.random() * 720 + 'deg');
        container.appendChild(chip);
        setTimeout(function() { 
            if (chip.parentNode) chip.remove(); 
        }, 500);
    }
}

function endGame(win) {
    if (!game.active && win === false && game.score === 0) return; // –£–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    
    game.active = false;
    if (game.timer) {
        clearInterval(game.timer);
        game.timer = null;
    }
    
    const sym = game.currency === 'ton' ? ' TON' : ' ‚ÇΩ';
    let prize = 0;
    
    if (win) {
        prize = game.bet * 2;
        if (game.currency === 'ton') user.balanceTon += prize;
        else user.balanceRub += prize;
    }
    
    updateBalance();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
    historyData.games.unshift({
        date: new Date(),
        bet: game.bet,
        currency: game.currency,
        score: game.score,
        win: win,
        prize: win ? prize : 0
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    const screen = document.getElementById('screen-result');
    screen.className = 'screen result-screen active ' + (win ? 'win' : 'lose');
    document.getElementById('result-icon').textContent = win ? 'üèÜ' : 'üíÄ';
    document.getElementById('result-title').textContent = win ? '–ü–æ–±–µ–¥–∞!' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!';
    document.getElementById('result-score').textContent = game.score;
    
    const amountEl = document.getElementById('result-amount');
    if (win) {
        amountEl.textContent = '+' + prize + sym;
        amountEl.style.color = 'var(--success)';
    } else {
        amountEl.textContent = '-' + game.bet + sym;
        amountEl.style.color = 'var(--danger)';
    }
    
    document.getElementById('result-message').textContent = win ? 
        '–û—Ç–ª–∏—á–Ω–∞—è –∏–≥—Ä–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!' : 
        '–ù–µ —Å–¥–∞–≤–∞–π—Å—è! –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    showScreen('result');
}

// Payments
function generatePayId() {
    const id = 'SBP_' + user.id.slice(-6) + '_' + Date.now().toString().slice(-6);
    document.getElementById('pay-id').textContent = id;
}

function submitDepositTon() {
    const amt = parseFloat(document.getElementById('dep-ton-amount').value);
    const addr = document.getElementById('dep-ton-from').value;
    
    if (!amt || amt < 1) { notify('–ú–∏–Ω–∏–º—É–º 1 TON'); return; }
    if (!addr) { notify('–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å'); return; }
    
    historyData.deposits.unshift({
        date: new Date(),
        amount: amt,
        currency: 'ton',
        status: 'pending'
    });
    
    notify('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è');
    goHome();
}

function submitDepositRub() {
    const amt = parseFloat(document.getElementById('dep-rub-amount').value);
    if (!amt || amt < 100) { notify('–ú–∏–Ω–∏–º—É–º 100 ‚ÇΩ'); return; }
    
    historyData.deposits.unshift({
        date: new Date(),
        amount: amt,
        currency: 'rub',
        status: 'pending'
    });
    
    notify('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –æ–∂–∏–¥–∞–π—Ç–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è');
    goHome();
}

function submitWithdrawTon() {
    const addr = document.getElementById('wd-ton-addr').value;
    const amt = parseFloat(document.getElementById('wd-ton-amount').value);
    
    if (!addr) { notify('–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å'); return; }
    if (!amt || amt < 5) { notify('–ú–∏–Ω–∏–º—É–º 5 TON'); return; }
    if (amt > user.balanceTon) { notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
    
    user.balanceTon -= amt;
    updateBalance();
    
    historyData.withdrawals.unshift({
        date: new Date(),
        amount: amt,
        currency: 'ton',
        status: 'pending'
    });
    
    notify('–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞!');
    goHome();
}

function submitWithdrawRub() {
    const phone = document.getElementById('wd-rub-phone').value;
    const amt = parseFloat(document.getElementById('wd-rub-amount').value);
    
    if (!phone) { notify('–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'); return; }
    if (!amt || amt < 500) { notify('–ú–∏–Ω–∏–º—É–º 500 ‚ÇΩ'); return; }
    if (amt > user.balanceRub) { notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
    
    user.balanceRub -= amt;
    updateBalance();
    
    historyData.withdrawals.unshift({
        date: new Date(),
        amount: amt,
        currency: 'rub',
        status: 'pending'
    });
    
    notify('–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞!');
    goHome();
}

// History - –ò–°–ü–†–ê–í–õ–ï–ù–û
function setHistoryTab(tab, element) {
    // –£–±–∏—Ä–∞–µ–º active —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('.history-tab').forEach(function(t) { 
        t.classList.remove('active'); 
    });
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∂–∞—Ç–æ–º—É
    if (element) element.classList.add('active');
    
    renderHistory(tab);
}

function renderHistory(tab) {
    tab = tab || 'games';
    const list = document.getElementById('history-list');
    const data = historyData[tab];
    
    if (!data || data.length === 0) {
        list.innerHTML = '<div class="empty-state">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
        return;
    }
    
    list.innerHTML = data.map(function(item) {
        if (tab === 'games') {
            return '<div class="history-item">' +
                '<div class="info">' +
                    '<div class="type">' + (item.win ? '‚úÖ –ü–æ–±–µ–¥–∞' : '‚ùå –ü–æ—Ä–∞–∂–µ–Ω–∏–µ') + '</div>' +
                    '<div class="date">' + item.date.toLocaleString() + '</div>' +
                '</div>' +
                '<div class="amount ' + (item.win ? 'positive' : 'negative') + '">' +
                    (item.win ? '+' : '-') + item.bet + ' ' + item.currency.toUpperCase() +
                '</div>' +
            '</div>';
        } else {
            return '<div class="history-item">' +
                '<div class="info">' +
                    '<div class="type">' + (tab === 'deposits' ? 'üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' : 'üí∏ –í—ã–≤–æ–¥') + '</div>' +
                    '<div class="date">' + item.date.toLocaleString() + '</div>' +
                '</div>' +
                '<div class="amount ' + (tab === 'deposits' ? 'positive' : 'negative') + '">' +
                    (tab === 'deposits' ? '+' : '-') + item.amount + ' ' + item.currency.toUpperCase() +
                '</div>' +
            '</div>';
        }
    }).join('');
}

// Utils
function updateBalance() {
    document.getElementById('bal-ton').textContent = user.balanceTon.toFixed(2);
    document.getElementById('bal-rub').textContent = user.balanceRub;
}

function copyText(text) {
    if (!text) return;
    if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(function() { notify('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'); });
    } else {
        const inp = document.createElement('input');
        inp.value = text;
        document.body.appendChild(inp);
        inp.select();
        document.execCommand('copy');
        document.body.removeChild(inp);
        notify('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    }
}

function notify(text) {
    const n = document.getElementById('notification');
    document.getElementById('notif-text').textContent = text;
    n.classList.add('show');
    setTimeout(function() { n.classList.remove('show'); }, 3000);
}

// Keyboard controls
document.addEventListener('keydown', function(e) {
    if (!game.active) return;
    if (e.key === 'ArrowLeft') doChop('left');
    if (e.key === 'ArrowRight') doChop('right');
});

// Touch/Mouse controls - –ò–°–ü–†–ê–í–õ–ï–ù–û (—É–±—Ä–∞–Ω—ã inline –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)
function setupGameControls() {
    const btnLeft = document.getElementById('btn-left');
    const btnRight = document.getElementById('btn-right');
    
    if (!btnLeft || !btnRight) return;
    
    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    const newBtnLeft = btnLeft.cloneNode(true);
    const newBtnRight = btnRight.cloneNode(true);
    btnLeft.parentNode.replaceChild(newBtnLeft, btnLeft);
    btnRight.parentNode.replaceChild(newBtnRight, btnRight);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
    function handleChop(e, side) {
        e.preventDefault();
        e.stopPropagation();
        doChop(side);
    }
    
    newBtnLeft.addEventListener('touchstart', function(e) { handleChop(e, 'left'); }, {passive: false});
    newBtnLeft.addEventListener('mousedown', function(e) { handleChop(e, 'left'); });
    
    newBtnRight.addEventListener('touchstart', function(e) { handleChop(e, 'right'); }, {passive: false});
    newBtnRight.addEventListener('mousedown', function(e) { handleChop(e, 'right'); });
}

// Init
updateBalance();

// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupGameControls);
} else {
    setupGameControls();
}
    </script>
</body>
</html>
