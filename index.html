<!DOCTYPE html> 
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TimberTON - –†—É–±–∏ –¥–µ—Ä–µ–≤—å—è –∑–∞ TON</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .balance-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            font-size: 16px;
        }
        
        .ton-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #0088cc, #00a8e8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .connect-btn {
            background: linear-gradient(135deg, #0088cc, #00a8e8);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
        }
        
        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }
        
        .score-board {
            text-align: center;
            margin-bottom: 20px;
            z-index: 10;
        }
        
        .score {
            font-size: 48px;
            font-weight: bold;
            text-shadow: 0 4px 8px rgba(0,0,0,0.5);
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .best-score {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .tree-container {
            position: relative;
            width: 120px;
            height: 400px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
        }
        
        .trunk-section {
            width: 80px;
            height: 60px;
            background: linear-gradient(90deg, #8B4513, #A0522D, #8B4513);
            border: 3px solid #5D3A1A;
            border-radius: 4px;
            position: relative;
            margin: 2px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .branch {
            position: absolute;
            width: 50px;
            height: 15px;
            background: linear-gradient(90deg, #228B22, #32CD32);
            border: 2px solid #006400;
            border-radius: 8px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .branch.left {
            left: -45px;
            transform: translateY(-50%) scaleX(-1);
        }
        
        .branch.right {
            right: -45px;
        }
        
        .lumberjack {
            position: absolute;
            bottom: -80px;
            width: 60px;
            height: 70px;
            transition: all 0.1s;
            z-index: 100;
        }
        
        .lumberjack.left {
            left: -70px;
        }
        
        .lumberjack.right {
            right: -70px;
            transform: scaleX(-1);
        }
        
        .lumberjack-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #ff6b6b 0%, #c92a2a 100%);
            border-radius: 10px 10px 20px 20px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        
        .lumberjack-head {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: #fdbf60;
            border-radius: 50%;
            border: 3px solid #8b4513;
        }
        
        .lumberjack-hat {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 20px;
            background: #c92a2a;
            border-radius: 5px;
        }
        
        .lumberjack-axe {
            position: absolute;
            right: -20px;
            top: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #silver, #gray);
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            transform-origin: left center;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            width: 100%;
            max-width: 400px;
        }
        
        .chop-btn {
            flex: 1;
            height: 80px;
            border: none;
            border-radius: 20px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 8px 0 rgba(0,0,0,0.3), 0 15px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .chop-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 rgba(0,0,0,0.3), 0 5px 10px rgba(0,0,0,0.2);
        }
        
        .chop-btn.left {
            background: linear-gradient(135deg, #ff6b6b, #c92a2a);
            color: white;
        }
        
        .chop-btn.right {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .chop-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .chop-btn:active::after {
            left: 100%;
        }
        
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .menu-content {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            border: 2px solid #4a5568;
        }
        
        .menu-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .bet-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
        }
        
        .bet-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .bet-amount {
            font-size: 36px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .bet-slider {
            width: 100%;
            margin: 15px 0;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #4a5568;
            outline: none;
        }
        
        .bet-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .prize-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .prize-card {
            background: rgba(255,215,0,0.1);
            border: 1px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
        }
        
        .prize-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .prize-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .start-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 6px 0 #2f855a, 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.1s;
        }
        
        .start-btn:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #2f855a, 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .wallet-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #4a5568;
        }
        
        .wallet-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #0088cc, #00a8e8);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .game-over-content {
            text-align: center;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .skull {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .final-score {
            font-size: 48px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .result-message {
            font-size: 18px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
        }
        
        .result-message.win {
            background: rgba(72, 187, 120, 0.2);
            border: 2px solid #48bb78;
            color: #48bb78;
        }
        
        .result-message.lose {
            background: rgba(245, 101, 101, 0.2);
            border: 2px solid #f56565;
            color: #f56565;
        }
        
        .action-btns {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 300px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .action-btn.primary {
            background: #48bb78;
            color: white;
        }
        
        .action-btn.secondary {
            background: #4a5568;
            color: white;
        }
        
        .particles {
            position: fixed;
            pointer-events: none;
            z-index: 500;
        }
        
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #8B4513;
            border-radius: 50%;
            animation: particle-fall 1s ease-out forwards;
        }
        
        @keyframes particle-fall {
            to {
                transform: translateY(300px) rotate(720deg);
                opacity: 0;
            }
        }
        
        .wood-chips {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .chip {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #DEB887;
            border-radius: 2px;
            animation: chip-fly 0.5s ease-out forwards;
        }
        
        @keyframes chip-fly {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(var(--rot));
                opacity: 0;
            }
        }
        
        .time-bar {
            width: 100%;
            height: 6px;
            background: #2d3748;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .time-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #ffd700, #f56565);
            transition: width 0.1s linear;
            border-radius: 3px;
        }
        
        .combo {
            position: absolute;
            top: 100px;
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s;
        }
        
        .combo.show {
            opacity: 1;
            transform: scale(1);
        }
        
        .leaderboard {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            margin: 5px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .leaderboard-rank {
            font-weight: bold;
            color: #ffd700;
            width: 30px;
        }
        
        .leaderboard-name {
            flex: 1;
            text-align: left;
            margin-left: 10px;
        }
        
        .leaderboard-score {
            font-weight: bold;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .tab-btn.active {
            background: #0088cc;
        }
        
        .withdraw-section {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        .input-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #4a5568;
            border-radius: 8px;
            background: #2d3748;
            color: white;
            font-size: 14px;
        }
        
        .withdraw-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="balance-display">
            <div class="ton-icon">üíé</div>
            <span id="balance">0.00 TON</span>
        </div>
        <button class="connect-btn" id="connectBtn" onclick="toggleWallet()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
    </div>

    <div id="ton-connect" class="hidden"></div>

    <!-- Main Menu -->
    <div id="mainMenu" class="menu-overlay">
        <div class="menu-content">
            <div class="menu-title">ü™ì TimberTON</div>
            <p style="opacity: 0.8; margin-bottom: 20px;">–†—É–±–∏ –¥–µ—Ä–µ–≤—å—è –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π TON!</p>
            
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('play')">–ò–≥—Ä–∞—Ç—å</button>
                <button class="tab-btn" onclick="switchTab('wallet')">–ö–æ—à–µ–ª–µ–∫</button>
            </div>

            <div id="playTab">
                <div class="bet-section">
                    <div class="bet-label">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞</div>
                    <div class="bet-amount" id="betAmount">0.1 TON</div>
                    <input type="range" class="bet-slider" id="betSlider" min="0.1" max="10" step="0.1" value="0.1" oninput="updateBet(this.value)">
                    
                    <div class="prize-info">
                        <div class="prize-card">
                            <div class="prize-label">–¶–µ–ª—å (–æ—á–∫–∏)</div>
                            <div class="prize-value" id="targetScore">50</div>
                        </div>
                        <div class="prize-card">
                            <div class="prize-label">–í—ã–∏–≥—Ä—ã—à</div>
                            <div class="prize-value" id="prizeAmount">0.2 TON</div>
                        </div>
                    </div>
                </div>

                <div class="leaderboard">
                    <div style="font-weight: bold; margin-bottom: 10px;">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</div>
                    <div id="leaderboardList">
                        <div class="leaderboard-item">
                            <span class="leaderboard-rank">1</span>
                            <span class="leaderboard-name">@timber_king</span>
                            <span class="leaderboard-score">142 –æ—á–∫–∞</span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="leaderboard-rank">2</span>
                            <span class="leaderboard-name">@lumberjack</span>
                            <span class="leaderboard-score">128 –æ—á–∫–∞</span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="leaderboard-rank">3</span>
                            <span class="leaderboard-name">@woodcutter</span>
                            <span class="leaderboard-score">115 –æ—á–∫–∞</span>
                        </div>
                    </div>
                </div>

                <button class="start-btn" id="startBtn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>

            <div id="walletTab" class="hidden">
                <div class="wallet-section">
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px;">–ë–∞–ª–∞–Ω—Å: <span id="walletBalance">0.00</span> TON</div>
                    
                    <button class="wallet-btn" onclick="showDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    
                    <div class="withdraw-section">
                        <div style="font-weight: bold; margin-bottom: 10px;">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</div>
                        
                        <div class="input-group">
                            <label>–°–ø–æ—Å–æ–± –≤—ã–≤–æ–¥–∞</label>
                            <select id="withdrawMethod" onchange="toggleWithdrawInputs()">
                                <option value="ton">TON –∫–æ—à–µ–ª–µ–∫</option>
                                <option value="sbp">–ö–∞—Ä—Ç–∞ (–°–ë–ü)</option>
                            </select>
                        </div>

                        <div id="tonWithdraw" class="input-group">
                            <label>TON –∞–¥—Ä–µ—Å</label>
                            <input type="text" id="tonAddress" placeholder="EQ...">
                        </div>

                        <div id="sbpWithdraw" class="input-group hidden">
                            <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                            <input type="tel" id="phoneNumber" placeholder="+7...">
                            <label style="margin-top: 10px;">–ë–∞–Ω–∫</label>
                            <select id="bankSelect">
                                <option>–°–±–µ—Ä–±–∞–Ω–∫</option>
                                <option>–¢–∏–Ω—å–∫–æ—Ñ—Ñ</option>
                                <option>–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫</option>
                                <option>–í–¢–ë</option>
                                <option>–†–∞–π—Ñ—Ñ–∞–π–∑–µ–Ω</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>–°—É–º–º–∞ (TON)</label>
                            <input type="number" id="withdrawAmount" step="0.01" min="0.1" placeholder="0.00">
                        </div>

                        <button class="withdraw-btn" onclick="requestWithdraw()">–í—ã–≤–µ—Å—Ç–∏</button>
                        <div style="font-size: 12px; opacity: 0.6; margin-top: 10px;">
                            –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: 0.5 TON<br>
                            –ö–æ–º–∏—Å—Å–∏—è: 0% (–°–ë–ü - —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Area -->
    <div id="gameArea" class="game-container hidden">
        <div class="time-bar">
            <div class="time-fill" id="timeFill" style="width: 100%"></div>
        </div>
        
        <div class="score-board">
            <div class="score" id="currentScore">0</div>
            <div class="best-score">–¶–µ–ª—å: <span id="gameTarget">50</span></div>
        </div>

        <div class="combo" id="combo">x1</div>

        <div class="tree-container" id="tree">
            <div class="lumberjack left" id="lumberjack">
                <div class="lumberjack-body">
                    <div class="lumberjack-head"></div>
                    <div class="lumberjack-hat"></div>
                    <div class="lumberjack-axe"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="chop-btn left" id="btnLeft" onmousedown="chop('left')" ontouchstart="chop('left')">‚óÄ</button>
            <button class="chop-btn right" id="btnRight" onmousedown="chop('right')" ontouchstart="chop('right')">‚ñ∂</button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOver" class="game-over hidden">
        <div class="game-over-content">
            <div class="skull">üíÄ</div>
            <div class="final-score" id="finalScore">0</div>
            <div id="resultMessage" class="result-message"></div>
            <div class="action-btns">
                <button class="action-btn primary" onclick="backToMenu()">–ú–µ–Ω—é</button>
                <button class="action-btn secondary" onclick="startGame()">–ï—â–µ —Ä–∞–∑</button>
            </div>
        </div>
    </div>

    <script>
        // Telegram WebApp init
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Game state
        let gameState = {
            score: 0,
            isPlaying: false,
            position: 'left',
            treeSections: [],
            timeLeft: 100,
            maxTime: 100,
            combo: 0,
            bet: 0.1,
            targetScore: 50,
            balance: 0,
            userId: tg.initDataUnsafe?.user?.id || 'demo_user',
            username: tg.initDataUnsafe?.user?.username || 'player'
        };

        // TON Connect
        let tonConnectUI = null;

        // Initialize TON Connect
        function initTonConnect() {
            if (document.getElementById('ton-connect')) {
                tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://your-domain.com/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect'
                });
            }
        }

        function toggleWallet() {
            const menu = document.getElementById('mainMenu');
            const isHidden = menu.classList.contains('hidden');
            
            if (isHidden) {
                menu.classList.remove('hidden');
                document.getElementById('gameArea').classList.add('hidden');
                switchTab('wallet');
            } else {
                if (tonConnectUI) {
                    tonConnectUI.openModal();
                } else {
                    // Demo mode
                    alert('–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –∫–æ—à–µ–ª–µ–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è');
                }
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'play') {
                document.getElementById('playTab').classList.remove('hidden');
                document.getElementById('walletTab').classList.add('hidden');
            } else {
                document.getElementById('playTab').classList.add('hidden');
                document.getElementById('walletTab').classList.remove('hidden');
            }
        }

        function updateBet(value) {
            gameState.bet = parseFloat(value);
            document.getElementById('betAmount').textContent = gameState.bet.toFixed(1) + ' TON';
            
            // Calculate target based on bet (higher bet = higher target)
            gameState.targetScore = Math.floor(30 + (gameState.bet * 20));
            document.getElementById('targetScore').textContent = gameState.targetScore;
            
            // Prize is 2x bet
            const prize = gameState.bet * 2;
            document.getElementById('prizeAmount').textContent = prize.toFixed(2) + ' TON';
        }

        function generateTree() {
            const tree = document.getElementById('tree');
            // Clear existing sections except lumberjack
            const sections = tree.querySelectorAll('.trunk-section');
            sections.forEach(s => s.remove());
            
            gameState.treeSections = [];
            
            // Generate 6 sections with random branches
            for (let i = 0; i < 6; i++) {
                const section = document.createElement('div');
                section.className = 'trunk-section';
                
                const hasBranch = Math.random() > 0.3 && i > 0; // No branch on first section
                if (hasBranch) {
                    const side = Math.random() > 0.5 ? 'left' : 'right';
                    const branch = document.createElement('div');
                    branch.className = `branch ${side}`;
                    section.appendChild(branch);
                    gameState.treeSections.push(side);
                } else {
                    gameState.treeSections.push(null);
                }
                
                tree.appendChild(section);
            }
        }

        function chop(side) {
            if (!gameState.isPlaying) return;
            
            // Check for collision
            const bottomSection = gameState.treeSections[0];
            if (bottomSection && bottomSection === side) {
                endGame(false);
                return;
            }
            
            // Add score
            gameState.score++;
            gameState.combo++;
            document.getElementById('currentScore').textContent = gameState.score;
            
            // Show combo
            const comboEl = document.getElementById('combo');
            if (gameState.combo > 5) {
                comboEl.textContent = 'x' + Math.floor(gameState.combo / 5);
                comboEl.classList.add('show');
            }
            
            // Add time for each chop (max 100)
            gameState.timeLeft = Math.min(gameState.timeLeft + 2, gameState.maxTime);
            
            // Move lumberjack
            gameState.position = side;
            const lumberjack = document.getElementById('lumberjack');
            lumberjack.className = `lumberjack ${side}`;
            
            // Animation
            lumberjack.style.transform = side === 'left' ? 'translateX(-10px) rotate(-10deg)' : 'translateX(10px) rotate(10deg) scaleX(-1)';
            setTimeout(() => {
                lumberjack.style.transform = side === 'left' ? '' : 'scaleX(-1)';
            }, 100);
            
            // Create particles
            createParticles(side);
            
            // Move tree down
            const tree = document.getElementById('tree');
            const sections = tree.querySelectorAll('.trunk-section');
            if (sections.length > 0) {
                sections[0].remove();
                gameState.treeSections.shift();
            }
            
            // Add new section at top
            const newSection = document.createElement('div');
            newSection.className = 'trunk-section';
            const hasBranch = Math.random() > 0.3;
            if (hasBranch) {
                const branchSide = Math.random() > 0.5 ? 'left' : 'right';
                const branch = document.createElement('div');
                branch.className = `branch ${branchSide}`;
                newSection.appendChild(branch);
                gameState.treeSections.push(branchSide);
            } else {
                gameState.treeSections.push(null);
            }
            tree.appendChild(newSection);
            
            // Check win condition
            if (gameState.score >= gameState.targetScore) {
                endGame(true);
            }
        }

        function createParticles(side) {
            const tree = document.getElementById('tree');
            const rect = tree.getBoundingClientRect();
            
            for (let i = 0; i < 5; i++) {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.style.left = (rect.width / 2) + 'px';
                chip.style.top = (rect.height - 60) + 'px';
                
                const tx = (Math.random() - 0.5) * 100 + (side === 'left' ? -50 : 50);
                const ty = -Math.random() * 100 - 50;
                const rot = Math.random() * 360;
                
                chip.style.setProperty('--tx', tx + 'px');
                chip.style.setProperty('--ty', ty + 'px');
                chip.style.setProperty('--rot', rot + 'deg');
                
                tree.appendChild(chip);
                setTimeout(() => chip.remove(), 500);
            }
        }

        function startGame() {
            if (gameState.balance < gameState.bet && !confirm('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ò–≥—Ä–∞—Ç—å –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ?')) {
                return;
            }
            
            gameState.balance -= gameState.bet;
            updateBalance();
            
            gameState.score = 0;
            gameState.isPlaying = true;
            gameState.timeLeft = gameState.maxTime;
            gameState.combo = 0;
            
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('gameTarget').textContent = gameState.targetScore;
            document.getElementById('combo').classList.remove('show');
            
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('hidden');
            
            generateTree();
            startTimer();
        }

        function startTimer() {
            const timer = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(timer);
                    return;
                }
                
                gameState.timeLeft -= 1;
                document.getElementById('timeFill').style.width = gameState.timeLeft + '%';
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(timer);
                    endGame(false);
                }
            }, 100);
        }

        function endGame(win) {
            gameState.isPlaying = false;
            
            const finalScore = document.getElementById('finalScore');
            const resultMessage = document.getElementById('resultMessage');
            
            finalScore.textContent = gameState.score;
            
            if (win) {
                const prize = gameState.bet * 2;
                gameState.balance += prize;
                updateBalance();
                
                resultMessage.className = 'result-message win';
                resultMessage.innerHTML = `üéâ –ü–æ–±–µ–¥–∞!<br>–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.toFixed(2)} TON`;
                
                // Save high score
                saveScore();
            } else {
                resultMessage.className = 'result-message lose';
                resultMessage.innerHTML = `üò¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ!<br>–í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ ${gameState.bet.toFixed(2)} TON`;
            }
            
            document.getElementById('gameOver').classList.remove('hidden');
        }

        function backToMenu() {
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function updateBalance() {
            document.getElementById('balance').textContent = gameState.balance.toFixed(2) + ' TON';
            document.getElementById('walletBalance').textContent = gameState.balance.toFixed(2);
        }

        function saveScore() {
            // In real app, send to backend
            const scores = JSON.parse(localStorage.getItem('timber_scores') || '[]');
            scores.push({
                user: gameState.username,
                score: gameState.score,
                date: new Date().toISOString()
            });
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem('timber_scores', JSON.stringify(scores.slice(0, 10)));
        }

        // Wallet functions
        function showDeposit() {
            const amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (TON):', '1');
            if (amount && parseFloat(amount) > 0) {
                // In real app, generate TON payment link
                alert(`–î–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ ${amount} TON:\n\n1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ ${amount} TON –Ω–∞ –∞–¥—Ä–µ—Å:\nEQDemoAddressForDeposits...\n\n2. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–µ—Ç–∏ –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω.\n\n(–í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)`);
                gameState.balance += parseFloat(amount);
                updateBalance();
            }
        }

        function toggleWithdrawInputs() {
            const method = document.getElementById('withdrawMethod').value;
            if (method === 'ton') {
                document.getElementById('tonWithdraw').classList.remove('hidden');
                document.getElementById('sbpWithdraw').classList.add('hidden');
            } else {
                document.getElementById('tonWithdraw').classList.add('hidden');
                document.getElementById('sbpWithdraw').classList.remove('hidden');
            }
        }

        function requestWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('withdrawMethod').value;
            
            if (!amount || amount < 0.5) {
                alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: 0.5 TON');
                return;
            }
            
            if (amount > gameState.balance) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                return;
            }
            
            let details = '';
            if (method === 'ton') {
                const address = document.getElementById('tonAddress').value;
                if (!address) {
                    alert('–í–≤–µ–¥–∏—Ç–µ TON –∞–¥—Ä–µ—Å');
                    return;
                }
                details = `–ê–¥—Ä–µ—Å: ${address}`;
            } else {
                const phone = document.getElementById('phoneNumber').value;
                const bank = document.getElementById('bankSelect').value;
                if (!phone) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                    return;
                }
                details = `–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n–ë–∞–Ω–∫: ${bank}`;
            }
            
            // In real app, send to backend for manual processing
            alert(`–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞!\n\n–°—É–º–º–∞: ${amount} TON\n–ú–µ—Ç–æ–¥: ${method.toUpperCase()}\n${details}\n\n–û–±—ã—á–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 10-30 –º–∏–Ω—É—Ç.`);
            
            gameState.balance -= amount;
            updateBalance();
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!gameState.isPlaying) return;
            if (e.key === 'ArrowLeft' || e.key === 'a') chop('left');
            if (e.key === 'ArrowRight' || e.key === 'd') chop('right');
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Init
        updateBalance();
        initTonConnect();

        // Demo: add some initial balance
        gameState.balance = 1.0;
        updateBalance();
    </script>
</body>
</html>
