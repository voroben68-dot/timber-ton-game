<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TimberTON - –†—É–±–∏ –¥–µ—Ä–µ–≤—å—è –∑–∞ TON –∏ ‚ÇΩ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .balance-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .currency-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .currency-icon.ton {
            background: linear-gradient(135deg, #0088cc, #00a8e8);
        }
        
        .currency-icon.rub {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .currency-toggle {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 3px;
            gap: 3px;
        }
        
        .currency-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.6);
            border-radius: 17px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .currency-btn.active {
            background: linear-gradient(135deg, #0088cc, #00a8e8);
            color: white;
        }
        
        .currency-btn.rub.active {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }
        
        .score-board {
            text-align: center;
            margin-bottom: 20px;
            z-index: 10;
        }
        
        .score {
            font-size: 48px;
            font-weight: bold;
            text-shadow: 0 4px 8px rgba(0,0,0,0.5);
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .best-score {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .tree-container {
            position: relative;
            width: 120px;
            height: 400px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
        }
        
        .trunk-section {
            width: 80px;
            height: 60px;
            background: linear-gradient(90deg, #8B4513, #A0522D, #8B4513);
            border: 3px solid #5D3A1A;
            border-radius: 4px;
            position: relative;
            margin: 2px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .branch {
            position: absolute;
            width: 50px;
            height: 15px;
            background: linear-gradient(90deg, #228B22, #32CD32);
            border: 2px solid #006400;
            border-radius: 8px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .branch.left {
            left: -45px;
            transform: translateY(-50%) scaleX(-1);
        }
        
        .branch.right {
            right: -45px;
        }
        
        .lumberjack {
            position: absolute;
            bottom: -80px;
            width: 60px;
            height: 70px;
            transition: all 0.1s;
            z-index: 100;
        }
        
        .lumberjack.left {
            left: -70px;
        }
        
        .lumberjack.right {
            right: -70px;
            transform: scaleX(-1);
        }
        
        .lumberjack-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #ff6b6b 0%, #c92a2a 100%);
            border-radius: 10px 10px 20px 20px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        
        .lumberjack-head {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: #fdbf60;
            border-radius: 50%;
            border: 3px solid #8b4513;
        }
        
        .lumberjack-hat {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 20px;
            background: #c92a2a;
            border-radius: 5px;
        }
        
        .lumberjack-axe {
            position: absolute;
            right: -20px;
            top: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #silver, #gray);
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            transform-origin: left center;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            width: 100%;
            max-width: 400px;
        }
        
        .chop-btn {
            flex: 1;
            height: 80px;
            border: none;
            border-radius: 20px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 8px 0 rgba(0,0,0,0.3), 0 15px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .chop-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 rgba(0,0,0,0.3), 0 5px 10px rgba(0,0,0,0.2);
        }
        
        .chop-btn.left {
            background: linear-gradient(135deg, #ff6b6b, #c92a2a);
            color: white;
        }
        
        .chop-btn.right {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .chop-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .chop-btn:active::after {
            left: 100%;
        }
        
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .menu-content {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            border: 2px solid #4a5568;
            position: relative;
        }
        
        .menu-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .currency-badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .currency-badge.ton {
            color: #00a8e8;
            border: 1px solid #0088cc;
        }
        
        .currency-badge.rub {
            color: #20c997;
            border: 1px solid #28a745;
        }
        
        .admin-btn-menu {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #e53e3e, #c53030);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
        }
        
        .bet-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
        }
        
        .bet-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .bet-amount {
            font-size: 36px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .bet-slider {
            width: 100%;
            margin: 15px 0;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #4a5568;
            outline: none;
        }
        
        .bet-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .prize-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .prize-card {
            background: rgba(255,215,0,0.1);
            border: 1px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
        }
        
        .prize-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .prize-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .limits-info {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            text-align: left;
        }
        
        .limits-info h4 {
            margin-bottom: 8px;
            color: #ffd700;
        }
        
        .limits-info div {
            margin: 4px 0;
            opacity: 0.9;
        }
        
        .start-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 6px 0 #2f855a, 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.1s;
        }
        
        .start-btn:disabled {
            background: #4a5568;
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .wallet-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #4a5568;
        }
        
        .wallet-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .wallet-btn.deposit {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .wallet-btn.ton {
            background: linear-gradient(135deg, #0088cc, #00a8e8);
        }
        
        .hidden {
            display: none !important;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .game-over-content {
            text-align: center;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .skull {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .final-score {
            font-size: 48px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .result-message {
            font-size: 18px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
        }
        
        .result-message.win {
            background: rgba(72, 187, 120, 0.2);
            border: 2px solid #48bb78;
            color: #48bb78;
        }
        
        .result-message.lose {
            background: rgba(245, 101, 101, 0.2);
            border: 2px solid #f56565;
            color: #f56565;
        }
        
        .action-btns {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 300px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .action-btn.primary {
            background: #48bb78;
            color: white;
        }
        
        .action-btn.secondary {
            background: #4a5568;
            color: white;
        }
        
        .particles {
            position: fixed;
            pointer-events: none;
            z-index: 500;
        }
        
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #8B4513;
            border-radius: 50%;
            animation: particle-fall 1s ease-out forwards;
        }
        
        @keyframes particle-fall {
            to {
                transform: translateY(300px) rotate(720deg);
                opacity: 0;
            }
        }
        
        .wood-chips {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .chip {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #DEB887;
            border-radius: 2px;
            animation: chip-fly 0.5s ease-out forwards;
        }
        
        @keyframes chip-fly {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(var(--rot));
                opacity: 0;
            }
        }
        
        .time-bar {
            width: 100%;
            height: 6px;
            background: #2d3748;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .time-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #ffd700, #f56565);
            transition: width 0.1s linear;
            border-radius: 3px;
        }
        
        .combo {
            position: absolute;
            top: 100px;
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s;
        }
        
        .combo.show {
            opacity: 1;
            transform: scale(1);
        }
        
        .leaderboard {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            margin: 5px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .leaderboard-rank {
            font-weight: bold;
            color: #ffd700;
            width: 30px;
        }
        
        .leaderboard-name {
            flex: 1;
            text-align: left;
            margin-left: 10px;
        }
        
        .leaderboard-score {
            font-weight: bold;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .tab-btn.active {
            background: #0088cc;
        }
        
        .tab-btn.rub.active {
            background: #28a745;
        }
        
        .withdraw-section {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        .input-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #4a5568;
            border-radius: 8px;
            background: #2d3748;
            color: white;
            font-size: 14px;
        }
        
        .withdraw-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .min-limit-warning {
            background: rgba(237, 137, 54, 0.2);
            border: 1px solid #ed8936;
            color: #ed8936;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .rate-info {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }

        .requisites-info {
            background: rgba(0,136,204,0.1);
            border: 1px solid #0088cc;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            text-align: left;
        }

        .requisites-info h4 {
            margin-bottom: 10px;
            color: #00a8e8;
        }

        .requisites-info .req-item {
            margin: 8px 0;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            word-break: break-all;
        }

        .requisites-info .req-label {
            font-size: 11px;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        .copy-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
            transition: all 0.2s;
        }

        .copy-btn:active {
            background: rgba(255,255,255,0.2);
        }

        /* ADMIN PANEL STYLES */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            z-index: 3000;
            padding: 20px;
            overflow-y: auto;
        }

        .admin-panel.active {
            display: flex;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e53e3e;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
            color: #e53e3e;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(229, 62, 62, 0.1);
            border: 1px solid #e53e3e;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #e53e3e;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .admin-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .admin-section h3 {
            margin-bottom: 15px;
            color: #ffd700;
            font-size: 18px;
        }

        .deposit-request {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #48bb78;
        }

        .deposit-request.pending {
            border-left-color: #ed8936;
        }

        .deposit-request.completed {
            border-left-color: #48bb78;
            opacity: 0.7;
        }

        .deposit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .user-info {
            font-weight: bold;
            font-size: 14px;
        }

        .deposit-amount {
            color: #ffd700;
            font-weight: bold;
        }

        .deposit-details {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .deposit-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-confirm {
            background: #48bb78;
            color: white;
        }

        .btn-reject {
            background: #e53e3e;
            color: white;
        }

        .btn-check {
            background: #0088cc;
            color: white;
        }

        .admin-input-group {
            margin-bottom: 15px;
        }

        .admin-input-group label {
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .admin-input-group input, .admin-input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #4a5568;
            border-radius: 8px;
            background: #2d3748;
            color: white;
            font-size: 14px;
        }

        .admin-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #e53e3e, #c53030);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .users-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 13px;
        }

        .user-balance {
            display: flex;
            gap: 10px;
        }

        .balance-tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .balance-tag.ton {
            background: rgba(0,136,204,0.3);
            color: #00a8e8;
        }

        .balance-tag.rub {
            background: rgba(40,167,69,0.3);
            color: #20c997;
        }

        .admin-code-input {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            padding: 20px;
        }

        .admin-code-input.active {
            display: flex;
        }

        .code-form {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            max-width: 300px;
            text-align: center;
            border: 2px solid #e53e3e;
        }

        .code-form h3 {
            margin-bottom: 20px;
            color: #e53e3e;
        }

        .code-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 5px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #1a202c;
            color: white;
            margin-bottom: 15px;
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .numpad-btn {
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .numpad-btn:active {
            background: rgba(255,255,255,0.2);
        }

        .numpad-btn.wide {
            grid-column: span 2;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            opacity: 0.5;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="balance-display">
            <div class="currency-icon" id="currencyIcon">üíé</div>
            <span id="balance">0.00</span>
        </div>
        <div class="currency-toggle">
            <button class="currency-btn active" id="btnTon" onclick="switchCurrency('ton')">TON</button>
            <button class="currency-btn rub" id="btnRub" onclick="switchCurrency('rub')">‚ÇΩ</button>
        </div>
    </div>

    <!-- Admin Code Input -->
    <div id="adminCodeInput" class="admin-code-input">
        <div class="code-form">
            <h3>üîê –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥</h3>
            <input type="password" class="code-input" id="codeDisplay" readonly placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <div class="numpad">
                <button class="numpad-btn" onclick="enterCode('1')">1</button>
                <button class="numpad-btn" onclick="enterCode('2')">2</button>
                <button class="numpad-btn" onclick="enterCode('3')">3</button>
                <button class="numpad-btn" onclick="enterCode('4')">4</button>
                <button class="numpad-btn" onclick="enterCode('5')">5</button>
                <button class="numpad-btn" onclick="enterCode('6')">6</button>
                <button class="numpad-btn" onclick="enterCode('7')">7</button>
                <button class="numpad-btn" onclick="enterCode('8')">8</button>
                <button class="numpad-btn" onclick="enterCode('9')">9</button>
                <button class="numpad-btn wide" onclick="enterCode('0')">0</button>
                <button class="numpad-btn" onclick="clearCode()" style="background: #e53e3e;">‚å´</button>
            </div>
            <button class="admin-btn" onclick="checkAdminCode()">–í–æ–π—Ç–∏</button>
            <button class="admin-close" onclick="closeAdminCodeInput()" style="margin-top: 10px; width: 100%;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-header">
            <div class="admin-title">
                üî¥ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                <span style="font-size: 12px; opacity: 0.7; font-weight: normal;">TimberTON</span>
            </div>
            <button class="admin-close" onclick="closeAdminPanel()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>

        <div class="admin-stats">
            <div class="stat-card">
                <div class="stat-value" id="pendingCount">0</div>
                <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
        </div>

        <div class="admin-section">
            <h3>‚è≥ –ó–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
            <div id="depositRequestsList">
                <div class="empty-state">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫</div>
            </div>
        </div>

        <div class="admin-section">
            <h3>üë§ –†—É—á–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
            <div class="admin-input-group">
                <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="manualUserId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            </div>
            <div class="admin-input-group">
                <label>–í–∞–ª—é—Ç–∞</label>
                <select id="manualCurrency">
                    <option value="ton">TON</option>
                    <option value="rub">–†—É–±–ª–∏</option>
                </select>
            </div>
            <div class="admin-input-group">
                <label>–°—É–º–º–∞</label>
                <input type="number" id="manualAmount" step="0.01" placeholder="0.00">
            </div>
            <button class="admin-btn" onclick="manualDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        </div>

        <div class="admin-section">
            <h3>üìä –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <div class="users-list" id="usersList">
                <div class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</div>
            </div>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="mainMenu" class="menu-overlay">
        <div class="menu-content">
            <button class="admin-btn-menu" onclick="openAdminCodeInput()">üîí –ê–î–ú–ò–ù</button>
            
            <div class="menu-title">ü™ì TimberTON</div>
            <div class="currency-badge" id="currencyBadge">üíé TON Mode</div>
            
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('play')">–ò–≥—Ä–∞—Ç—å</button>
                <button class="tab-btn" id="walletTabBtn" onclick="switchTab('wallet')">–ö–æ—à–µ–ª–µ–∫</button>
            </div>

            <div id="playTab">
                <div class="bet-section">
                    <div class="bet-label">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞</div>
                    <div class="bet-amount" id="betAmount">0.5 TON</div>
                    <input type="range" class="bet-slider" id="betSlider" min="0.5" max="10" step="0.5" value="0.5" oninput="updateBet(this.value)">
                    
                    <div class="prize-info">
                        <div class="prize-card">
                            <div class="prize-label">–¶–µ–ª—å (–æ—á–∫–∏)</div>
                            <div class="prize-value" id="targetScore">40</div>
                        </div>
                        <div class="prize-card">
                            <div class="prize-label">–í—ã–∏–≥—Ä—ã—à</div>
                            <div class="prize-value" id="prizeAmount">1.0 TON</div>
                        </div>
                    </div>
                </div>

                <div class="limits-info" id="limitsInfo">
                    <h4>üí∞ –õ–∏–º–∏—Ç—ã TON</h4>
                    <div>‚Ä¢ –ú–∏–Ω. –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: 1 TON</div>
                    <div>‚Ä¢ –ú–∏–Ω. –≤—ã–≤–æ–¥: 5 TON</div>
                    <div>‚Ä¢ –ú–∏–Ω. —Å—Ç–∞–≤–∫–∞: 0.5 TON</div>
                </div>

                <div class="leaderboard">
                    <div style="font-weight: bold; margin-bottom: 10px;">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</div>
                    <div id="leaderboardList">
                        <div class="leaderboard-item">
                            <span class="leaderboard-rank">1</span>
                            <span class="leaderboard-name">@timber_king</span>
                            <span class="leaderboard-score">142 –æ—á–∫–∞</span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="leaderboard-rank">2</span>
                            <span class="leaderboard-name">@lumberjack</span>
                            <span class="leaderboard-score">128 –æ—á–∫–∞</span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="leaderboard-rank">3</span>
                            <span class="leaderboard-name">@woodcutter</span>
                            <span class="leaderboard-score">115 –æ—á–∫–∞</span>
                        </div>
                    </div>
                </div>

                <button class="start-btn" id="startBtn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>

            <div id="walletTab" class="hidden">
                <div class="wallet-section">
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px;">
                        –ë–∞–ª–∞–Ω—Å: <span id="walletBalance">0.00</span> <span id="walletCurrency">TON</span>
                    </div>
                    
                    <button class="wallet-btn deposit" onclick="showDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    
                    <div class="withdraw-section">
                        <div style="font-weight: bold; margin-bottom: 10px;">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</div>
                        
                        <div class="min-limit-warning" id="withdrawWarning">
                            –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: 5 TON
                        </div>

                        <div class="input-group">
                            <label>–°–ø–æ—Å–æ–± –≤—ã–≤–æ–¥–∞</label>
                            <select id="withdrawMethod" onchange="toggleWithdrawInputs()">
                                <option value="ton">TON –∫–æ—à–µ–ª–µ–∫</option>
                                <option value="sbp">–°–ë–ü (–û–∑–æ–Ω –ë–∞–Ω–∫)</option>
                            </select>
                        </div>

                        <div id="tonWithdraw" class="input-group">
                            <label>TON –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                            <input type="text" id="tonAddress" placeholder="UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh">
                        </div>

                        <div id="sbpWithdraw" class="input-group hidden">
                            <label>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–û–∑–æ–Ω –ë–∞–Ω–∫)</label>
                            <input type="tel" id="phoneNumber" value="+7 (994) 140-23-39" readonly>
                            <div style="font-size: 12px; opacity: 0.7; margin-top: 5px; color: #20c997;">
                                ‚úÖ –û–∑–æ–Ω –ë–∞–Ω–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
                            </div>
                        </div>

                        <div class="input-group">
                            <label>–°—É–º–º–∞</label>
                            <input type="number" id="withdrawAmount" step="0.01" min="5" placeholder="0.00">
                        </div>

                        <button class="withdraw-btn" onclick="requestWithdraw()">–í—ã–≤–µ—Å—Ç–∏</button>
                        <div class="rate-info" id="rateInfo"></div>
                    </div>

                    <div class="requisites-info">
                        <h4>üìã –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h4>
                        <div class="req-item">
                            <div class="req-label">TON –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
                            <div style="font-size: 12px; word-break: break-all;">UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh</div>
                            <button class="copy-btn" onclick="copyToClipboard('UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        <div class="req-item" style="margin-top: 10px;">
                            <div class="req-label">–°–ë–ü (–û–∑–æ–Ω –ë–∞–Ω–∫):</div>
                            <div style="font-size: 14px;">+7 (994) 140-23-39</div>
                            <button class="copy-btn" onclick="copyToClipboard('+79941402339')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Area -->
    <div id="gameArea" class="game-container hidden">
        <div class="time-bar">
            <div class="time-fill" id="timeFill" style="width: 100%"></div>
        </div>
        
        <div class="score-board">
            <div class="score" id="currentScore">0</div>
            <div class="best-score">–¶–µ–ª—å: <span id="gameTarget">40</span></div>
        </div>

        <div class="combo" id="combo">x1</div>

        <div class="tree-container" id="tree">
            <div class="lumberjack left" id="lumberjack">
                <div class="lumberjack-body">
                    <div class="lumberjack-head"></div>
                    <div class="lumberjack-hat"></div>
                    <div class="lumberjack-axe"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="chop-btn left" id="btnLeft" onmousedown="chop('left')" ontouchstart="chop('left')">‚óÄ</button>
            <button class="chop-btn right" id="btnRight" onmousedown="chop('right')" ontouchstart="chop('right')">‚ñ∂</button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOver" class="game-over hidden">
        <div class="game-over-content">
            <div class="skull">üíÄ</div>
            <div class="final-score" id="finalScore">0</div>
            <div id="resultMessage" class="result-message"></div>
            <div class="action-btns">
                <button class="action-btn primary" onclick="backToMenu()">–ú–µ–Ω—é</button>
                <button class="action-btn secondary" onclick="startGame()">–ï—â–µ —Ä–∞–∑</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const OWNER_REQUISITES = {
            ton: 'UQD-U9iJRqGCZhtJRg7GDvUUP-IwhGu1jAknZXdRmxR3pSOh',
            sbp: {
                phone: '+7 (994) 140-23-39',
                bank: '–û–∑–æ–Ω –ë–∞–Ω–∫',
                rawPhone: '+79941402339'
            }
        };

        const ADMIN_CODE = '1995';
        const ADMIN_IDS = ['demo_user'];

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentCode = '';
        
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let exchangeRate = 200;

        let gameState = {
            score: 0,
            isPlaying: false,
            position: 'left',
            treeSections: [],
            timeLeft: 100,
            maxTime: 100,
            combo: 0,
            currency: 'ton',
            bet: 0.5,
            targetScore: 40,
            balance: {
                ton: 0,
                rub: 0
            },
            limits: {
                ton: {
                    minDeposit: 1,
                    minWithdraw: 5,
                    minBet: 0.5,
                    maxBet: 10
                },
                rub: {
                    minDeposit: 100,
                    minWithdraw: 500,
                    minBet: 50,
                    maxBet: 5000
                }
            },
            userId: tg.initDataUnsafe?.user?.id?.toString() || 'demo_user',
            username: tg.initDataUnsafe?.user?.username || 'player'
        };

        const Storage = {
            getUsers: () => JSON.parse(localStorage.getItem('timber_users') || '{}'),
            saveUser: (userId, data) => {
                const users = Storage.getUsers();
                users[userId] = {...(users[userId] || {}), ...data, lastSeen: new Date().toISOString()};
                localStorage.setItem('timber_users', JSON.stringify(users));
                return users[userId];
            },
            getUser: (userId) => Storage.getUsers()[userId] || null,
            getDeposits: () => JSON.parse(localStorage.getItem('timber_deposits') || '[]'),
            addDeposit: (deposit) => {
                const deposits = Storage.getDeposits();
                deposits.push({
                    id: Date.now().toString(),
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    ...deposit
                });
                localStorage.setItem('timber_deposits', JSON.stringify(deposits));
                return deposits[deposits.length - 1];
            },
            updateDeposit: (depositId, updates) => {
                const deposits = Storage.getDeposits();
                const idx = deposits.findIndex(d => d.id === depositId);
                if (idx !== -1) {
                    deposits[idx] = {...deposits[idx], ...updates, updatedAt: new Date().toISOString()};
                    localStorage.setItem('timber_deposits', JSON.stringify(deposits));
                    return deposits[idx];
                }
                return null;
            }
        };

        // ==================== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ====================
        
        function openAdminCodeInput() {
            currentCode = '';
            document.getElementById('codeDisplay').value = '';
            document.getElementById('adminCodeInput').classList.add('active');
        }

        function closeAdminCodeInput() {
            document.getElementById('adminCodeInput').classList.remove('active');
            currentCode = '';
        }

        function enterCode(digit) {
            if (currentCode.length < 4) {
                currentCode += digit;
                document.getElementById('codeDisplay').value = '‚Ä¢'.repeat(currentCode.length);
            }
        }

        function clearCode() {
            currentCode = currentCode.slice(0, -1);
            document.getElementById('codeDisplay').value = currentCode ? '‚Ä¢'.repeat(currentCode.length) : '';
        }

        function checkAdminCode() {
            if (currentCode === ADMIN_CODE || ADMIN_IDS.includes(gameState.userId)) {
                closeAdminCodeInput();
                openAdminPanel();
                tg.showPopup({title: '‚úÖ –£—Å–ø–µ—Ö', message: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å!'});
            } else {
                tg.showPopup({title: '‚ùå –û—à–∏–±–∫–∞', message: '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞'});
                clearCode();
            }
        }

        function openAdminPanel() {
            document.getElementById('adminPanel').classList.add('active');
            updateAdminStats();
            renderDepositRequests();
            renderUsersList();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
        }

        function updateAdminStats() {
            const deposits = Storage.getDeposits();
            const pending = deposits.filter(d => d.status === 'pending').length;
            const users = Object.keys(Storage.getUsers()).length;
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('totalUsers').textContent = users || 1;
        }

        function renderDepositRequests() {
            const deposits = Storage.getDeposits().sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            const container = document.getElementById('depositRequestsList');
            
            if (deposits.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫</div>';
                return;
            }
            
            container.innerHTML = deposits.map(d => `
                <div class="deposit-request ${d.status}">
                    <div class="deposit-header">
                        <span class="user-info">@${d.username || d.userId}</span>
                        <span class="deposit-amount">${d.amount} ${d.currency.toUpperCase()}</span>
                    </div>
                    <div class="deposit-details">
                        ID: ${d.userId} | ${new Date(d.createdAt).toLocaleString()}<br>
                        –ú–µ—Ç–æ–¥: ${d.method === 'ton' ? 'TON' : '–°–ë–ü'} | ${d.status === 'pending' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç' : '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ'}
                    </div>
                    ${d.status === 'pending' ? `
                        <div class="deposit-actions">
                            <button class="btn-small btn-check" onclick="checkDeposit('${d.id}')">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                            <button class="btn-small btn-confirm" onclick="confirmDeposit('${d.id}')">‚úì –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                            <button class="btn-small btn-reject" onclick="rejectDeposit('${d.id}')">‚úï –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderUsersList() {
            const users = Storage.getUsers();
            const container = document.getElementById('usersList');
            const userEntries = Object.entries(users);
            
            if (userEntries.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</div>';
                return;
            }
            
            container.innerHTML = userEntries.map(([id, data]) => `
                <div class="user-item">
                    <div>
                        <div style="font-weight: bold;">@${data.username || id}</div>
                        <div style="font-size: 11px; opacity: 0.7;">ID: ${id}</div>
                    </div>
                    <div class="user-balance">
                        <span class="balance-tag ton">${(data.balance?.ton || 0).toFixed(2)} TON</span>
                        <span class="balance-tag rub">${(data.balance?.rub || 0).toFixed(0)} ‚ÇΩ</span>
                    </div>
                </div>
            `).join('');
        }

        function confirmDeposit(depositId) {
            const deposit = Storage.getDeposits().find(d => d.id === depositId);
            if (!deposit) return;
            
            const user = Storage.getUser(deposit.userId) || {};
            const currentBalance = user.balance || {ton: 0, rub: 0};
            currentBalance[deposit.currency] = (currentBalance[deposit.currency] || 0) + deposit.amount;
            
            Storage.saveUser(deposit.userId, {
                ...user,
                balance: currentBalance,
                username: deposit.username
            });
            
            Storage.updateDeposit(depositId, {status: 'completed'});
            
            if (deposit.userId === gameState.userId) {
                gameState.balance = currentBalance;
                updateBalance();
            }
            
            tg.showPopup({
                title: '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                message: `–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @${deposit.username} –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${deposit.amount} ${deposit.currency.toUpperCase()}`
            });
            
            updateAdminStats();
            renderDepositRequests();
            renderUsersList();
        }

        function rejectDeposit(depositId) {
            Storage.updateDeposit(depositId, {status: 'rejected'});
            renderDepositRequests();
            tg.showPopup({title: '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ', message: '–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞'});
        }

        function checkDeposit(depositId) {
            const deposit = Storage.getDeposits().find(d => d.id === depositId);
            if (!deposit) return;
            
            tg.showPopup({
                title: 'üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞',
                message: `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${deposit.username}\nID: ${deposit.userId}\n–°—É–º–º–∞: ${deposit.amount} ${deposit.currency.toUpperCase()}\n–ú–µ—Ç–æ–¥: ${deposit.method}\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –≤–∞—à–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã:\n${deposit.method === 'ton' ? OWNER_REQUISITES.ton : OWNER_REQUISITES.sbp.phone}`
            });
        }

        function manualDeposit() {
            const userId = document.getElementById('manualUserId').value.trim();
            const currency = document.getElementById('manualCurrency').value;
            const amount = parseFloat(document.getElementById('manualAmount').value);
            
            if (!userId || !amount || amount <= 0) {
                tg.showPopup({title: '‚ùå –û—à–∏–±–∫–∞', message: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'});
                return;
            }
            
            const user = Storage.getUser(userId) || {};
            const currentBalance = user.balance || {ton: 0, rub: 0};
            currentBalance[currency] = (currentBalance[currency] || 0) + amount;
            
            Storage.saveUser(userId, {
                ...user,
                balance: currentBalance
            });
            
            if (userId === gameState.userId) {
                gameState.balance = currentBalance;
                updateBalance();
            }
            
            tg.showPopup({
                title: '‚úÖ –£—Å–ø–µ—Ö',
                message: `–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId} –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ${currency.toUpperCase()}`
            });
            
            document.getElementById('manualUserId').value = '';
            document.getElementById('manualAmount').value = '';
            renderUsersList();
        }

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    tg.showPopup({title: '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', message: '–†–µ–∫–≤–∏–∑–∏—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞'});
                });
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                tg.showPopup({title: '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', message: '–†–µ–∫–≤–∏–∑–∏—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞'});
            }
        }

        function switchCurrency(curr) {
            gameState.currency = curr;
            
            document.getElementById('btnTon').classList.toggle('active', curr === 'ton');
            document.getElementById('btnRub').classList.toggle('active', curr === 'rub');
            
            const icon = document.getElementById('currencyIcon');
            icon.textContent = curr === 'ton' ? 'üíé' : '‚ÇΩ';
            icon.className = 'currency-icon ' + curr;
            
            const badge = document.getElementById('currencyBadge');
            badge.textContent = curr === 'ton' ? 'üíé TON Mode' : '‚ÇΩ –†—É–±–ª–∏ Mode';
            badge.className = 'currency-badge ' + curr;
            
            updateLimitsDisplay();
            
            const slider = document.getElementById('betSlider');
            const limits = gameState.limits[curr];
            slider.min = limits.minBet;
            slider.max = limits.maxBet;
            slider.step = curr === 'ton' ? 0.5 : 50;
            slider.value = limits.minBet;
            
            updateBet(slider.value);
            updateBalance();
            updateStartButton();
        }

        function updateLimitsDisplay() {
            const limits = gameState.limits[gameState.currency];
            const info = document.getElementById('limitsInfo');
            
            if (gameState.currency === 'ton') {
                info.innerHTML = `
                    <h4>üí∞ –õ–∏–º–∏—Ç—ã TON</h4>
                    <div>‚Ä¢ –ú–∏–Ω. –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: ${limits.minDeposit} TON</div>
                    <div>‚Ä¢ –ú–∏–Ω. –≤—ã–≤–æ–¥: ${limits.minWithdraw} TON</div>
                    <div>‚Ä¢ –ú–∏–Ω. —Å—Ç–∞–≤–∫–∞: ${limits.minBet} TON</div>
                `;
            } else {
                info.innerHTML = `
                    <h4>üí∞ –õ–∏–º–∏—Ç—ã –†—É–±–ª–∏</h4>
                    <div>‚Ä¢ –ú–∏–Ω. –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: ${limits.minDeposit} ‚ÇΩ</div>
                    <div>‚Ä¢ –ú–∏–Ω. –≤—ã–≤–æ–¥: ${limits.minWithdraw} ‚ÇΩ</div>
                    <div>‚Ä¢ –ú–∏–Ω. —Å—Ç–∞–≤–∫–∞: ${limits.minBet} ‚ÇΩ</div>
                `;
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach((btn, idx) => {
                if (idx < 2) btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (tab === 'play') {
                document.getElementById('playTab').classList.remove('hidden');
                document.getElementById('walletTab').classList.add('hidden');
            } else {
                document.getElementById('playTab').classList.add('hidden');
                document.getElementById('walletTab').classList.remove('hidden');
                updateWithdrawInfo();
            }
        }

        function updateBet(value) {
            gameState.bet = parseFloat(value);
            const curr = gameState.currency.toUpperCase();
            document.getElementById('betAmount').textContent = gameState.bet + ' ' + curr;
            
            const baseTarget = gameState.currency === 'ton' ? 30 : 30;
            const multiplier = gameState.bet / gameState.limits[gameState.currency].minBet;
            gameState.targetScore = Math.floor(baseTarget + (multiplier * 10));
            document.getElementById('targetScore').textContent = gameState.targetScore;
            
            const prize = gameState.bet * 2;
            document.getElementById('prizeAmount').textContent = prize + ' ' + curr;
        }

        function updateWithdrawInfo() {
            const limits = gameState.limits[gameState.currency];
            const warning = document.getElementById('withdrawWarning');
            const input = document.getElementById('withdrawAmount');
            const rateInfo = document.getElementById('rateInfo');
            
            if (gameState.currency === 'ton') {
                warning.textContent = `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: ${limits.minWithdraw} TON`;
                input.min = limits.minWithdraw;
                input.placeholder = '5.00';
                rateInfo.textContent = '';
            } else {
                warning.textContent = `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: ${limits.minWithdraw} ‚ÇΩ`;
                input.min = limits.minWithdraw;
                input.placeholder = '500';
                rateInfo.textContent = `–ö—É—Ä—Å: 1 TON ‚âà ${exchangeRate} ‚ÇΩ`;
            }
        }

        function generateTree() {
            const tree = document.getElementById('tree');
            const sections = tree.querySelectorAll('.trunk-section');
            sections.forEach(s => s.remove());
            
            gameState.treeSections = [];
            
            for (let i = 0; i < 6; i++) {
                const section = document.createElement('div');
                section.className = 'trunk-section';
                
                const hasBranch = Math.random() > 0.3 && i > 0;
                if (hasBranch) {
                    const side = Math.random() > 0.5 ? 'left' : 'right';
                    const branch = document.createElement('div');
                    branch.className = `branch ${side}`;
                    section.appendChild(branch);
                    gameState.treeSections.push(side);
                } else {
                    gameState.treeSections.push(null);
                }
                
                tree.appendChild(section);
            }
        }

        function chop(side) {
            if (!gameState.isPlaying) return;
            
            const bottomSection = gameState.treeSections[0];
            if (bottomSection && bottomSection === side) {
                endGame(false);
                return;
            }
            
            gameState.score++;
            gameState.combo++;
            document.getElementById('currentScore').textContent = gameState.score;
            
            const comboEl = document.getElementById('combo');
            if (gameState.combo > 5) {
                comboEl.textContent = 'x' + Math.floor(gameState.combo / 5);
                comboEl.classList.add('show');
            }
            
            gameState.timeLeft = Math.min(gameState.timeLeft + 2, gameState.maxTime);
            
            gameState.position = side;
            const lumberjack = document.getElementById('lumberjack');
            lumberjack.className = `lumberjack ${side}`;
            
            lumberjack.style.transform = side === 'left' ? 'translateX(-10px) rotate(-10deg)' : 'translateX(10px) rotate(10deg) scaleX(-1)';
            setTimeout(() => {
                lumberjack.style.transform = side === 'left' ? '' : 'scaleX(-1)';
            }, 100);
            
            createParticles(side);
            
            const tree = document.getElementById('tree');
            const sections = tree.querySelectorAll('.trunk-section');
            if (sections.length > 0) {
                sections[0].remove();
                gameState.treeSections.shift();
            }
            
            const newSection = document.createElement('div');
            newSection.className = 'trunk-section';
            const hasBranch = Math.random() > 0.3;
            if (hasBranch) {
                const branchSide = Math.random() > 0.5 ? 'left' : 'right';
                const branch = document.createElement('div');
                branch.className = `branch ${branchSide}`;
                newSection.appendChild(branch);
                gameState.treeSections.push(branchSide);
            } else {
                gameState.treeSections.push(null);
            }
            tree.appendChild(newSection);
            
            if (gameState.score >= gameState.targetScore) {
                endGame(true);
            }
        }

        function createParticles(side) {
            const tree = document.getElementById('tree');
            const rect = tree.getBoundingClientRect();
            
            for (let i = 0; i < 5; i++) {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.style.left = (rect.width / 2) + 'px';
                chip.style.top = (rect.height - 60) + 'px';
                
                const tx = (Math.random() - 0.5) * 100 + (side === 'left' ? -50 : 50);
                const ty = -Math.random() * 100 - 50;
                const rot = Math.random() * 360;
                
                chip.style.setProperty('--tx', tx + 'px');
                chip.style.setProperty('--ty', ty + 'px');
                chip.style.setProperty('--rot', rot + 'deg');
                
                tree.appendChild(chip);
                setTimeout(() => chip.remove(), 500);
            }
        }

        function updateStartButton() {
            const btn = document.getElementById('startBtn');
            const hasBalance = gameState.balance[gameState.currency] >= gameState.bet;
            
            if (!hasBalance) {
                btn.disabled = true;
                btn.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
                btn.style.background = '#4a5568';
            } else {
                btn.disabled = false;
                btn.textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
                btn.style.background = '';
            }
        }

        function startGame() {
            const limits = gameState.limits[gameState.currency];
            
            if (gameState.balance[gameState.currency] < gameState.bet) {
                tg.showPopup({title: '–û—à–∏–±–∫–∞', message: `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –º–∏–Ω–∏–º—É–º –Ω–∞ ${limits.minBet} ${gameState.currency.toUpperCase()}`});
                return;
            }
            
            gameState.balance[gameState.currency] -= gameState.bet;
            updateBalance();
            
            gameState.score = 0;
            gameState.isPlaying = true;
            gameState.timeLeft = gameState.maxTime;
            gameState.combo = 0;
            
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('gameTarget').textContent = gameState.targetScore;
            document.getElementById('combo').classList.remove('show');
            
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('hidden');
            
            generateTree();
            startTimer();
        }

        function startTimer() {
            const timer = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(timer);
                    return;
                }
                
                gameState.timeLeft -= 1;
                document.getElementById('timeFill').style.width = gameState.timeLeft + '%';
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(timer);
                    endGame(false);
                }
            }, 100);
        }

        function endGame(win) {
            gameState.isPlaying = false;
            
            const finalScore = document.getElementById('finalScore');
            const resultMessage = document.getElementById('resultMessage');
            const curr = gameState.currency.toUpperCase();
            
            finalScore.textContent = gameState.score;
            
            if (win) {
                const prize = gameState.bet * 2;
                gameState.balance[gameState.currency] += prize;
                updateBalance();
                
                resultMessage.className = 'result-message win';
                resultMessage.innerHTML = `üéâ –ü–æ–±–µ–¥–∞!<br>–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize} ${curr}`;
                saveScore();
            } else {
                resultMessage.className = 'result-message lose';
                resultMessage.innerHTML = `üò¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ!<br>–í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ ${gameState.bet} ${curr}`;
            }
            
            document.getElementById('gameOver').classList.remove('hidden');
        }

        function backToMenu() {
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            updateStartButton();
        }

        function updateBalance() {
            const curr = gameState.currency;
            const balance = gameState.balance[curr].toFixed(curr === 'ton' ? 2 : 0);
            const symbol = curr === 'ton' ? 'TON' : '‚ÇΩ';
            
            document.getElementById('balance').textContent = balance + ' ' + symbol;
            document.getElementById('walletBalance').textContent = balance;
            document.getElementById('walletCurrency').textContent = symbol;
            
            Storage.saveUser(gameState.userId, {
                balance: gameState.balance,
                username: gameState.username
            });
            
            updateStartButton();
        }

        function saveScore() {
            const scores = JSON.parse(localStorage.getItem('timber_scores') || '[]');
            scores.push({
                user: gameState.username,
                score: gameState.score,
                currency: gameState.currency,
                date: new Date().toISOString()
            });
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem('timber_scores', JSON.stringify(scores.slice(0, 10)));
        }

        function showDeposit() {
            const limits = gameState.limits[gameState.currency];
            const curr = gameState.currency.toUpperCase();
            
            if (gameState.currency === 'ton') {
                tg.showPopup({
                    title: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON',
                    message: `–û—Ç–ø—Ä–∞–≤—å—Ç–µ TON –Ω–∞ –∞–¥—Ä–µ—Å:\n\n${OWNER_REQUISITES.ton}\n\n–ú–∏–Ω–∏–º—É–º: ${limits.minDeposit} TON`,
                    buttons: [
                        {id: 'copy', type: 'default', text: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å'},
                        {id: 'confirm', type: 'default', text: '–Ø –æ—Ç–ø—Ä–∞–≤–∏–ª'},
                        {type: 'cancel'}
                    ]
                }, (btnId) => {
                    if (btnId === 'copy') {
                        copyToClipboard(OWNER_REQUISITES.ton);
                    } else if (btnId === 'confirm') {
                        Storage.addDeposit({
                            userId: gameState.userId,
                            username: gameState.username,
                            amount: limits.minDeposit,
                            currency: 'ton',
                            method: 'ton'
                        });
                        tg.showPopup({
                            title: '‚è≥ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞',
                            message: '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.'
                        });
                    }
                });
            } else {
                tg.showPopup({
                    title: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä—É–±–ª–µ–π',
                    message: `–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –ø–æ –°–ë–ü (–û–∑–æ–Ω –ë–∞–Ω–∫):\n\n–¢–µ–ª–µ—Ñ–æ–Ω: ${OWNER_REQUISITES.sbp.phone}\n\n–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∂–∏—Ç–µ: ${gameState.userId}`,
                    buttons: [
                        {id: 'copy', type: 'default', text: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä'},
                        {id: 'confirm', type: 'default', text: '–Ø –æ—Ç–ø—Ä–∞–≤–∏–ª'},
                        {type: 'cancel'}
                    ]
                }, (btnId) => {
                    if (btnId === 'copy') {
                        copyToClipboard(OWNER_REQUISITES.sbp.rawPhone);
                    } else if (btnId === 'confirm') {
                        Storage.addDeposit({
                            userId: gameState.userId,
                            username: gameState.username,
                            amount: limits.minDeposit,
                            currency: 'rub',
                            method: 'sbp'
                        });
                        tg.showPopup({
                            title: '‚è≥ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞',
                            message: '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.'
                        });
                    }
                });
            }
        }

        function toggleWithdrawInputs() {
            const method = document.getElementById('withdrawMethod').value;
            if (method === 'ton') {
                document.getElementById('tonWithdraw').classList.remove('hidden');
                document.getElementById('sbpWithdraw').classList.add('hidden');
                document.getElementById('tonAddress').value = OWNER_REQUISITES.ton;
            } else {
                document.getElementById('tonWithdraw').classList.add('hidden');
                document.getElementById('sbpWithdraw').classList.remove('hidden');
                document.getElementById('phoneNumber').value = OWNER_REQUISITES.sbp.phone;
            }
        }

        function requestWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const limits = gameState.limits[gameState.currency];
            const curr = gameState.currency;
            
            if (!amount || amount < limits.minWithdraw) {
                tg.showPopup({title: '–û—à–∏–±–∫–∞', message: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: ${limits.minWithdraw} ${curr.toUpperCase()}`});
                return;
            }
            
            if (amount > gameState.balance[curr]) {
                tg.showPopup({title: '–û—à–∏–±–∫–∞', message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'});
                return;
            }
            
            gameState.balance[curr] -= amount;
            updateBalance();
            
            tg.showPopup({
                title: '–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞',
                message: `‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ ${amount} ${curr.toUpperCase()} —Å–æ–∑–¥–∞–Ω–∞!`
            });
            
            document.getElementById('withdrawAmount').value = '';
        }

        document.addEventListener('keydown', (e) => {
            if (!gameState.isPlaying) return;
            if (e.key === 'ArrowLeft' || e.key === 'a') chop('left');
            if (e.key === 'ArrowRight' || e.key === 'd') chop('right');
        });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, false);

        // Init
        updateLimitsDisplay();
        updateBet(gameState.limits.ton.minBet);
        
        const savedUser = Storage.getUser(gameState.userId);
        if (savedUser && savedUser.balance) {
            gameState.balance = savedUser.balance;
        }
        updateBalance();
        updateStartButton();
        toggleWithdrawInputs();
    </script>
</body>
</html>
